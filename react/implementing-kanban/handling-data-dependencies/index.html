<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
    <meta
      name="description"
      content="
So far we have developed an application for keeping track of notes in localStorage. To get closer t…" />
    <meta
      name="keywords"
      content="" />
    <meta property="og:site_name" content="SurviveJS" />
    <meta property="og:title" content="Handling Data Dependencies" />
    <meta property="og:description" content="
So far we have developed an application for keeping track of notes in localStorage. To get closer t…" />
    <meta name="twitter:title" content="Handling Data Dependencies" />
    <meta name="twitter:description" content="
So far we have developed an application for keeping track of notes in localStorage. To get closer t…" />
    <meta name="twitter:site" content="@SurviveJS" />
    <title>Handling Data Dependencies</title>
    
    <link rel='icon' type='image/png' href='/favicon.png'></link>

    
      <link href="/site.67ad5b4f8122a45407cd.css" rel="stylesheet">
    

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"
    />
  </head>
  <body>
    <div><div class="page"><div class="header-image" style="background-image:url(/d526d6827c577bb4c17f6134fb4a4c27.jpg)"></div><h1 class="page__heading">Handling Data Dependencies</h1><div class="header-extra"><a href="https://www.flickr.com/photos/61745819@N00/10588140955">Radek Orszewski (CC BY-NC-SA)</a></div><div class="page__container"><div class="css-xfgthk css-20xtq50"><label for="sidebar-toggle" class="css-7vv0nt css-20xtq52">Table of contents</label><input type="checkbox" id="sidebar-toggle" class="css-38lglc css-20xtq53"/><div class="css-nyzxad css-20xtq51"><div class="toc-nav__wrapper"><div class="toc-nav__section"><input id="search" class="toc-nav__search" placeholder="Search"/></div><div class="toc-nav__section"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/react/introduction/">Introduction</a></li><li class="toc-part"><a class="toc-nav__link part" href="/react/getting-started/">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/introduction-to-react/">Introduction to React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/setting-up-the-project/">Setting Up the Project</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/implementing-notes/">Implementing a Note Application</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/deleting-notes/">Deleting Notes</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/understanding-react-components/">Understanding React Components</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/editing-notes/">Editing Notes</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/getting-started/styling-notes/">Styling the Notes Application</a></li><li class="toc-part"><a class="toc-nav__link part" href="/react/implementing-kanban/">Implementing Kanban</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/implementing-kanban/react-and-flux/">React and Flux</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/implementing-kanban/implementing-store-and-actions/">Implementing NoteStore and NoteActions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/implementing-kanban/implementing-persistency/">Implementing Persistency over localStorage</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Handling Data Dependencies</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/implementing-kanban/editing-lanes/">Editing Lanes</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/implementing-kanban/drag-and-drop/">Implementing Drag and Drop</a></li><li class="toc-part"><a class="toc-nav__link part" href="/react/advanced-techniques/">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/advanced-techniques/testing-react/">Testing React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/advanced-techniques/typing-with-react/">Typing with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/advanced-techniques/styling-react/">Styling React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/advanced-techniques/structuring-react-projects/">Structuring React Projects</a></li><li class="toc-part"><a class="toc-nav__link part" href="/react/appendices/">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/appendices/language-features/">Language Features</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/appendices/understanding-decorators/">Understanding Decorators</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/react/appendices/troubleshooting/">Troubleshooting</a></li></ul></div><div class="toc-nav__section"></div></div></div></div><div class="page__main"><div class="page__section"><div><blockquote class="latestpost tip"><a class="latestpost-link" href="/blog/fastpack-interview/">Fastpack - Pack JavaScript code fast and easy - Interview with Oleksiy Golovko</a></blockquote></div><div class="chapter-content"><p>So far we have developed an application for keeping track of notes in <code>localStorage</code>. To get closer to Kanban, we need to model the concept of <code>Lane</code>. A <code>Lane</code> is something that should be able to contain many <code>Notes</code> within itself and track their order. One way to model this is simply to make a <code>Lane</code> point at <code>Notes</code> through an array of <code>Note</code> ids.</p>
<p>This relation could be reversed. A <code>Note</code> could point at a <code>Lane</code> using an id and maintain information about its position within a <code>Lane</code>. In this case, we are going to stick with the former design as that works well with re-ordering later on.</p>
<h2 class="header"><a class="header-anchor" href="#defining-lanes" id="defining-lanes"></a><span class="text">Defining <code>Lanes</code></span><a class="header-anchor-select" href="#defining-lanes">#</a></h2>
<p>As earlier, we can use the same idea of two components here. There will be a component for the higher level (i.e., <code>Lanes</code>) and for the lower level (i.e., <code>Lane</code>). The higher level component will deal with lane ordering. A <code>Lane</code> will render itself (i.e., name and <code>Notes</code>) and have basic manipulation operations.</p>
<p>Just as with <code>Notes</code>, we are going to need a set of actions. For now it is enough if we can just create new lanes so we can create a corresponding action for that as below:</p>
<p><strong>app/actions/LaneActions.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> alt <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/alt'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> alt<span class="token punctuation" >.</span><span class="token function" >generateActions</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >'create'</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>In addition, we are going to need a <code>LaneStore</code> and a method matching to <code>create</code>. The idea is pretty much the same as for <code>NoteStore</code> earlier. <code>create</code> will concatenate a new lane to the list of lanes. After that, the change will propagate to the listeners (i.e., <code>FinalStore</code> and components).</p>
<p><strong>app/stores/LaneStore.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token keyword keyword-class" >class</span> <span class="token class-name" >LaneStore</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token function" >constructor</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token function" >bindActions</span><span class="token punctuation brackets-parentheses" >(</span>LaneActions<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>lanes <span class="token operator" >=</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span>
  <span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span>lane<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token comment" spellcheck="true" >// If `notes` aren't provided for some reason,</span>
    <span class="token comment" spellcheck="true" >// default to an empty array.</span>
    lane<span class="token punctuation" >.</span>notes <span class="token operator" >=</span> lane<span class="token punctuation" >.</span>notes <span class="token operator" >||</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token function" >setState</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      lanes<span class="token punctuation" >:</span> <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>lanes<span class="token punctuation" >.</span><span class="token function" >concat</span><span class="token punctuation brackets-parentheses" >(</span>lane<span class="token punctuation brackets-parentheses" >)</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>To connect <code>LaneStore</code> with our application, we need to connect it to it through <code>setup</code>:</p>
<p><strong>app/components/Provider/setup.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> storage <span class="token keyword keyword-from" >from</span> <span class="token string" >'../../libs/storage'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> persist <span class="token keyword keyword-from" >from</span> <span class="token string" >'../../libs/persist'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> NoteStore <span class="token keyword keyword-from" >from</span> <span class="token string" >'../../stores/NoteStore'</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
<span class="token keyword keyword-import" >import</span> LaneStore <span class="token keyword keyword-from" >from</span> <span class="token string" >'../../stores/LaneStore'</span><span class="token punctuation" >;</span>
</div>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> alt <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  alt<span class="token punctuation" >.</span><span class="token function" >addStore</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >'NoteStore'</span><span class="token punctuation" >,</span> NoteStore<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
  alt<span class="token punctuation" >.</span><span class="token function" >addStore</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >'LaneStore'</span><span class="token punctuation" >,</span> LaneStore<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>

  <span class="token function" >persist</span><span class="token punctuation brackets-parentheses" >(</span>alt<span class="token punctuation" >,</span> <span class="token function" >storage</span><span class="token punctuation brackets-parentheses" >(</span>localStorage<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span> <span class="token string" >'app'</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>We are also going to need a <code>Lanes</code> container to display our lanes:</p>
<p><strong>app/components/Lanes.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> Lane <span class="token keyword keyword-from" >from</span> <span class="token string" >'./Lane'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>lanes<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span>
  <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lanes"</span><span class="token operator" >&gt;</span><span class="token punctuation brackets-braces" >{</span>lanes<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation brackets-parentheses" >(</span>lane <span class="token operator" >=&gt;</span>
    <span class="token operator" >&lt;</span>Lane className<span class="token operator" >=</span><span class="token string" >"lane"</span> key<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >.</span>id<span class="token punctuation brackets-braces" >}</span> lane<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation brackets-braces" >}</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
<span class="token punctuation brackets-parentheses" >)</span>
</code></pre>
<p>And finally we can add a little stub for <code>Lane</code> to make sure our application doesn&#39;t crash when we connect <code>Lanes</code> with it. A lot of the current <code>App</code> logic will move here eventually:</p>
<p><strong>app/components/Lane.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >,</span> <span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span>
  <span class="token operator" >&lt;</span>div <span class="token punctuation brackets-braces" >{</span><span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >.</span>name<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
<span class="token punctuation brackets-parentheses" >)</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#connecting-lanes-with-app" id="connecting-lanes-with-app"></a><span class="text">Connecting <code>Lanes</code> with <code>App</code></span><a class="header-anchor-select" href="#connecting-lanes-with-app">#</a></h2>
<p>Next, we need to make room for <code>Lanes</code> at <code>App</code>. We will simply replace <code>Notes</code> references with <code>Lanes</code>, set up lane actions, and store. This means a lot of the old code can disappear. Replace <code>App</code> with the following code:</p>
<p><strong>app/components/App.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> uuid <span class="token keyword keyword-from" >from</span> <span class="token string" >'uuid'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> connect <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/connect'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> Lanes <span class="token keyword keyword-from" >from</span> <span class="token string" >'./Lanes'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >App</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>LaneActions<span class="token punctuation" >,</span> lanes<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addLane</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    LaneActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      id<span class="token punctuation" >:</span> uuid<span class="token punctuation" >.</span><span class="token function" >v4</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
      name<span class="token punctuation" >:</span> <span class="token string" >'New lane'</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token punctuation brackets-parentheses" >(</span>
    <span class="token operator" >&lt;</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>button className<span class="token operator" >=</span><span class="token string" >"add-lane"</span> onClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>addLane<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span><span class="token operator" >+</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>button<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>Lanes lanes<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>lanes<span class="token punctuation brackets-braces" >}</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token function" >connect</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>lanes<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
  lanes
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span>
  LaneActions
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >(</span>App<span class="token punctuation brackets-parentheses" >)</span>
</code></pre>
<p>If you check out the implementation at the browser, you can see that the current implementation doesn&#39;t do much. You should be able to add new lanes to the Kanban and see &quot;New lane&quot; text per each but that&#39;s about it. To restore the note related functionality, we need to focus on modeling <code>Lane</code> further.</p>
<h2 class="header"><a class="header-anchor" href="#modeling-lane" id="modeling-lane"></a><span class="text">Modeling <code>Lane</code></span><a class="header-anchor-select" href="#modeling-lane">#</a></h2>
<p><code>Lane</code> will render a name and associated <code>Notes</code>. The example below has been modeled largely after our earlier implementation of <code>App</code>. Replace the file contents entirely as follows:</p>
<p><strong>app/components/Lane.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> uuid <span class="token keyword keyword-from" >from</span> <span class="token string" >'uuid'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> connect <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/connect'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> NoteActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/NoteActions'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> Notes <span class="token keyword keyword-from" >from</span> <span class="token string" >'./Notes'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >Lane</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
  lane<span class="token punctuation" >,</span> notes<span class="token punctuation" >,</span> NoteActions<span class="token punctuation" >,</span> <span class="token operator" >...</span>props
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >editNote</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span>id<span class="token punctuation" >,</span> task<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    NoteActions<span class="token punctuation" >.</span><span class="token function" >update</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>id<span class="token punctuation" >,</span> task<span class="token punctuation" >,</span> editing<span class="token punctuation" >:</span> <span class="token boolean" >false</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addNote</span> <span class="token operator" >=</span> e <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-const" >const</span> noteId <span class="token operator" >=</span> uuid<span class="token punctuation" >.</span><span class="token function" >v4</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    NoteActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      id<span class="token punctuation" >:</span> noteId<span class="token punctuation" >,</span>
      task<span class="token punctuation" >:</span> <span class="token string" >'New task'</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >deleteNote</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation" >,</span> e<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    NoteActions<span class="token punctuation" >.</span><span class="token keyword keyword-delete" >delete</span><span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >activateNoteEdit</span> <span class="token operator" >=</span> id <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    NoteActions<span class="token punctuation" >.</span><span class="token function" >update</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>id<span class="token punctuation" >,</span> editing<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token punctuation brackets-parentheses" >(</span>
    <span class="token operator" >&lt;</span>div <span class="token punctuation brackets-braces" >{</span><span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-header"</span><span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-add-note"</span><span class="token operator" >&gt;</span>
          <span class="token operator" >&lt;</span>button onClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>addNote<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span><span class="token operator" >+</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>button<span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-name"</span><span class="token operator" >&gt;</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >.</span>name<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>Notes
        notes<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>notes<span class="token punctuation brackets-braces" >}</span>
        onNoteClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>activateNoteEdit<span class="token punctuation brackets-braces" >}</span>
        onEdit<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>editNote<span class="token punctuation brackets-braces" >}</span>
        onDelete<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>deleteNote<span class="token punctuation brackets-braces" >}</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token function" >connect</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>notes<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
    notes
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span>
    NoteActions
  <span class="token punctuation brackets-braces" >}</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >(</span>Lane<span class="token punctuation brackets-parentheses" >)</span>
</code></pre>
<p>If you run the application and try adding new notes, you can see there&#39;s something wrong. Every note you add is shared by all lanes. If a note is modified, other lanes update too.</p>
<p><figure><img src="/d618cf530502374db48754ead661ef7e.png" alt="Duplicate notes" class="" width="" height="" /><figcaption>Duplicate notes</figcaption></figure></p>
<p>The reason why this happens is simple. Our <code>NoteStore</code> is a singleton. This means every component that is listening to <code>NoteStore</code> will receive the same data. We will need to resolve this problem somehow.</p>
<h2 class="header"><a class="header-anchor" href="#making-lanes-responsible-of-notes" id="making-lanes-responsible-of-notes"></a><span class="text">Making <code>Lanes</code> Responsible of <code>Notes</code></span><a class="header-anchor-select" href="#making-lanes-responsible-of-notes">#</a></h2>
<p>Currently, our <code>Lane</code> contains just an array of objects. Each of the objects knows its <em>id</em> and <em>name</em>. We&#39;ll need something more sophisticated.</p>
<p>Each <code>Lane</code> needs to know which <code>Notes</code> belong to it. If a <code>Lane</code> contained an array of <code>Note</code> ids, it could then filter and display the <code>Notes</code> belonging to it. We&#39;ll implement a scheme to achieve this next.</p>
<h3 class="header"><a class="header-anchor" href="#understanding-attachtolane" id="understanding-attachtolane"></a><span class="text">Understanding <code>attachToLane</code></span><a class="header-anchor-select" href="#understanding-attachtolane">#</a></h3>
<p>When we add a new <code>Note</code> to the system using <code>addNote</code>, we need to make sure it&#39;s associated to some <code>Lane</code>. This association can be modeled using a method, such as <code>LaneActions.attachToLane({laneId: &lt;id&gt;, noteId: &lt;id&gt;})</code>. Here&#39;s an example of how it could work:</p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addNote</span> <span class="token operator" >=</span> e <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-const" >const</span> noteId <span class="token operator" >=</span> uuid<span class="token punctuation" >.</span><span class="token function" >v4</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  NoteActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
    id<span class="token punctuation" >:</span> noteId<span class="token punctuation" >,</span>
    task<span class="token punctuation" >:</span> <span class="token string" >'New task'</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  LaneActions<span class="token punctuation" >.</span><span class="token function" >attachToLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
    laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
    noteId
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>This is just one way to handle <code>noteId</code>. We could push the generation logic within <code>NoteActions.create</code> and then return the generated id from it. We could also handle it through a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. This would be very useful if we added a back-end to our implementation. Here&#39;s how it would look like then:</p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addNote</span> <span class="token operator" >=</span> e <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  NoteActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
    task<span class="token punctuation" >:</span> <span class="token string" >'New task'</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation brackets-parentheses" >(</span>noteId <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    LaneActions<span class="token punctuation" >.</span><span class="token function" >attachToLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
      noteId<span class="token punctuation" >:</span> noteId
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>Now we have declared a clear dependency between <code>NoteActions.create</code> and <code>LaneActions.attachToLane</code>. This would be one valid alternative especially if you need to go further with the implementation.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>You could model the API using positional parameters and end up with <code>LaneActions.attachToLane(laneId, note.id)</code>. I prefer the object form as it reads well and you don&#39;t have to care about the order.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>Another way to handle the dependency problem would be to use Flux dispatcher related feature known as <a href="http://alt.js.org/guide/wait-for/">waitFor</a>. It allows us to state dependencies on store level. It is better to avoid that if you can, though, as data management solutions like Redux make it redundant. Using <code>Promises</code> as above can help as well.</blockquote><h3 class="header"><a class="header-anchor" href="#setting-up-attachtolane" id="setting-up-attachtolane"></a><span class="text">Setting Up <code>attachToLane</code></span><a class="header-anchor-select" href="#setting-up-attachtolane">#</a></h3>
<p>To get started we should add <code>attachToLane</code> to actions as before:</p>
<p><strong>app/actions/LaneActions.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> alt <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/alt'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> alt<span class="token punctuation" >.</span><span class="token function" >generateActions</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token string" >'create'</span><span class="token punctuation" >,</span> <span class="token string" >'attachToLane'</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>In order to implement <code>attachToLane</code>, we need to find a lane matching to the given lane id and then attach note id to it. Furthermore, each note should belong only to one lane at a time. We can perform a rough check against that:</p>
<p><strong>app/stores/LaneStore.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token keyword keyword-class" >class</span> <span class="token class-name" >LaneStore</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token operator" >...</span>
<div class="leanpub-insert">
  <span class="token function" >attachToLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>laneId<span class="token punctuation" >,</span> noteId<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token function" >setState</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      lanes<span class="token punctuation" >:</span> <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>lanes<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation brackets-parentheses" >(</span>lane <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
        <span class="token keyword keyword-if" >if</span><span class="token punctuation brackets-parentheses" >(</span>lane<span class="token punctuation" >.</span>notes<span class="token punctuation" >.</span><span class="token function" >includes</span><span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
          lane<span class="token punctuation" >.</span>notes <span class="token operator" >=</span> lane<span class="token punctuation" >.</span>notes<span class="token punctuation" >.</span><span class="token function" >filter</span><span class="token punctuation brackets-parentheses" >(</span>note <span class="token operator" >=&gt;</span> note <span class="token operator" >!==</span> noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation brackets-braces" >}</span>

        <span class="token keyword keyword-if" >if</span><span class="token punctuation brackets-parentheses" >(</span>lane<span class="token punctuation" >.</span>id <span class="token operator" >===</span> laneId<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
          lane<span class="token punctuation" >.</span>notes <span class="token operator" >=</span> lane<span class="token punctuation" >.</span>notes<span class="token punctuation" >.</span><span class="token function" >concat</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-square" >[</span>noteId<span class="token punctuation brackets-square" >]</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation brackets-braces" >}</span>

        <span class="token keyword keyword-return" >return</span> lane<span class="token punctuation" >;</span>
      <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span>
</div>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>Just being able to attach notes to a lane isn&#39;t enough. We are also going to need some way to detach them. This comes up when we are removing notes.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>We could give a warning here in case you are trying to attach a note to a lane that doesn&#39;t exist. <code>console.warn</code> would work nicely for that.</blockquote><h3 class="header"><a class="header-anchor" href="#setting-up-detachfromlane" id="setting-up-detachfromlane"></a><span class="text">Setting Up <code>detachFromLane</code></span><a class="header-anchor-select" href="#setting-up-detachfromlane">#</a></h3>
<p>We can model a similar counter-operation <code>detachFromLane</code> using an API like this:</p>
<pre><code class="lang-javascript">LaneActions<span class="token punctuation" >.</span><span class="token function" >detachFromLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>noteId<span class="token punctuation" >,</span> laneId<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
NoteActions<span class="token punctuation" >.</span><span class="token keyword keyword-delete" >delete</span><span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<blockquote class="tip"><i class="icon-attention-circled"></i>Just like with <code>attachToLane</code>, you could model the API using positional parameters and end up with <code>LaneActions.detachFromLane(laneId, noteId)</code>.</blockquote><p>Again, we should set up an action:</p>
<p><strong>app/actions/LaneActions.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> alt <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/alt'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> alt<span class="token punctuation" >.</span><span class="token function" >generateActions</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token string" >'create'</span><span class="token punctuation" >,</span> <span class="token string" >'attachToLane'</span><span class="token punctuation" >,</span> <span class="token string" >'detachFromLane'</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>The implementation will resemble <code>attachToLane</code>. In this case, we&#39;ll remove the possibly found <code>Note</code> instead:</p>
<p><strong>app/stores/LaneStore.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token keyword keyword-class" >class</span> <span class="token class-name" >LaneStore</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token operator" >...</span>
<div class="leanpub-insert">
  <span class="token function" >detachFromLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>laneId<span class="token punctuation" >,</span> noteId<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token function" >setState</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      lanes<span class="token punctuation" >:</span> <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>lanes<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation brackets-parentheses" >(</span>lane <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
        <span class="token keyword keyword-if" >if</span><span class="token punctuation brackets-parentheses" >(</span>lane<span class="token punctuation" >.</span>id <span class="token operator" >===</span> laneId<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
          lane<span class="token punctuation" >.</span>notes <span class="token operator" >=</span> lane<span class="token punctuation" >.</span>notes<span class="token punctuation" >.</span><span class="token function" >filter</span><span class="token punctuation brackets-parentheses" >(</span>note <span class="token operator" >=&gt;</span> note <span class="token operator" >!==</span> noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation brackets-braces" >}</span>

        <span class="token keyword keyword-return" >return</span> lane<span class="token punctuation" >;</span>
      <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span>
</div>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>Given we have enough logic in place now, we can start connecting it with the user interface.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>It is possible <code>detachFromLane</code> doesn&#39;t detach anything. If this case is detected, it would be nice to use <code>console.warn</code> to let the developer know about the situation.</blockquote><h3 class="header"><a class="header-anchor" href="#connecting-lane-with-the-logic" id="connecting-lane-with-the-logic"></a><span class="text">Connecting <code>Lane</code> with the Logic</span><a class="header-anchor-select" href="#connecting-lane-with-the-logic">#</a></h3>
<p>To make this work, there are a couple of places to tweak at <code>Lane</code>:</p>
<ul>
<li>When adding a note, we need to <strong>attach</strong> it to the current lane.</li>
<li>When deleting a note, we need to <strong>detach</strong> it from the current lane.</li>
<li>When rendering a lane, we need to <strong>select</strong> notes belonging to it. It is important to render then notes in the order they belong to a lane. This needs extra logic.</li>
</ul>
<p>These changes map to <code>Lane</code> as follows:</p>
<p><strong>app/components/Lane.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> uuid <span class="token keyword keyword-from" >from</span> <span class="token string" >'uuid'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> connect <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/connect'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> NoteActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/NoteActions'</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
<span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>
</div>
<span class="token keyword keyword-import" >import</span> Notes <span class="token keyword keyword-from" >from</span> <span class="token string" >'./Notes'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >Lane</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
<div class="leanpub-delete">
  lane<span class="token punctuation" >,</span> notes<span class="token punctuation" >,</span> NoteActions<span class="token punctuation" >,</span> <span class="token operator" >...</span>props
</div>
<div class="leanpub-insert">
  lane<span class="token punctuation" >,</span> notes<span class="token punctuation" >,</span> LaneActions<span class="token punctuation" >,</span> NoteActions<span class="token punctuation" >,</span> <span class="token operator" >...</span>props
</div>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >editNote</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span>id<span class="token punctuation" >,</span> task<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token operator" >...</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addNote</span> <span class="token operator" >=</span> e <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-const" >const</span> noteId <span class="token operator" >=</span> uuid<span class="token punctuation" >.</span><span class="token function" >v4</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    NoteActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      id<span class="token punctuation" >:</span> noteId<span class="token punctuation" >,</span>
      task<span class="token punctuation" >:</span> <span class="token string" >'New task'</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
    LaneActions<span class="token punctuation" >.</span><span class="token function" >attachToLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
      noteId
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >deleteNote</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation" >,</span> e<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<div class="leanpub-insert">
    LaneActions<span class="token punctuation" >.</span><span class="token function" >detachFromLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
      noteId
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
    NoteActions<span class="token punctuation" >.</span><span class="token keyword keyword-delete" >delete</span><span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >activateNoteEdit</span> <span class="token operator" >=</span> id <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    NoteActions<span class="token punctuation" >.</span><span class="token function" >update</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>id<span class="token punctuation" >,</span> editing<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token punctuation brackets-parentheses" >(</span>
    <span class="token operator" >&lt;</span>div <span class="token punctuation brackets-braces" >{</span><span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-header"</span><span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-add-note"</span><span class="token operator" >&gt;</span>
          <span class="token operator" >&lt;</span>button onClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>addNote<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span><span class="token operator" >+</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>button<span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-name"</span><span class="token operator" >&gt;</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >.</span>name<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>Notes
<div class="leanpub-delete">
        notes<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>notes<span class="token punctuation brackets-braces" >}</span>
</div>
<div class="leanpub-insert">
        notes<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span><span class="token function" >selectNotesByIds</span><span class="token punctuation brackets-parentheses" >(</span>notes<span class="token punctuation" >,</span> lane<span class="token punctuation" >.</span>notes<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-braces" >}</span>
</div>
        onNoteClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>activateNoteEdit<span class="token punctuation brackets-braces" >}</span>
        onEdit<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>editNote<span class="token punctuation brackets-braces" >}</span>
        onDelete<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>deleteNote<span class="token punctuation brackets-braces" >}</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

<div class="leanpub-insert">
<span class="token keyword keyword-function" >function</span> <span class="token function" >selectNotesByIds</span><span class="token punctuation brackets-parentheses" >(</span>allNotes<span class="token punctuation" >,</span> noteIds <span class="token operator" >=</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token comment" spellcheck="true" >// `reduce` is a powerful method that allows us to</span>
  <span class="token comment" spellcheck="true" >// fold data. You can implement `filter` and `map`</span>
  <span class="token comment" spellcheck="true" >// through it. Here we are using it to concatenate</span>
  <span class="token comment" spellcheck="true" >// notes matching to the ids.</span>
  <span class="token keyword keyword-return" >return</span> noteIds<span class="token punctuation" >.</span><span class="token function" >reduce</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >(</span>notes<span class="token punctuation" >,</span> id<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span>
    <span class="token comment" spellcheck="true" >// Concatenate possible matching ids to the result</span>
    notes<span class="token punctuation" >.</span><span class="token function" >concat</span><span class="token punctuation brackets-parentheses" >(</span>
      allNotes<span class="token punctuation" >.</span><span class="token function" >filter</span><span class="token punctuation brackets-parentheses" >(</span>note <span class="token operator" >=&gt;</span> note<span class="token punctuation" >.</span>id <span class="token operator" >===</span> id<span class="token punctuation brackets-parentheses" >)</span>
    <span class="token punctuation brackets-parentheses" >)</span>
  <span class="token punctuation" >,</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>
</div>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token function" >connect</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>notes<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
    notes
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span>
<div class="leanpub-delete">
    NoteActions
</div>
<div class="leanpub-insert">
    NoteActions<span class="token punctuation" >,</span>
    LaneActions
</div>
  <span class="token punctuation brackets-braces" >}</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >(</span>Lane<span class="token punctuation brackets-parentheses" >)</span>
</code></pre>
<p>If you try using the application now, you should see that each lane is able to maintain its own notes:</p>
<p><figure><img src="/0f9ffec19ea8bc60fd93c0700dcfce52.png" alt="Separate notes" class="" width="" height="" /><figcaption>Separate notes</figcaption></figure></p>
<p>The current structure allows us to keep singleton stores and a flat data structure. Dealing with references is a little awkward, but that&#39;s consistent with the Flux architecture. You can see the same theme in the <a href="https://github.com/survivejs-demos/redux-demo">Redux implementation</a>. The <a href="https://github.com/survivejs-demos/mobx-demo">MobX one</a> avoids the problem altogether given we can use proper references there.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><code>selectNotesByIds</code> could have been written in terms of <code>map</code> and <code>find</code>. In that case you would have ended up with <code>noteIds.map(id =&gt; allNotes.find(note =&gt; note.id === id));</code>. You would need to polyfill <code>find</code> in this case to support older browsers, though.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>Normalizing the data would have made <code>selectNotesByIds</code> trivial. If you are using a solution like Redux, normalization can make operations like this easy.</blockquote><h2 class="header"><a class="header-anchor" href="#extracting-laneheader-from-lane" id="extracting-laneheader-from-lane"></a><span class="text">Extracting <code>LaneHeader</code> from <code>Lane</code></span><a class="header-anchor-select" href="#extracting-laneheader-from-lane">#</a></h2>
<p><code>Lane</code> is starting to feel like a big component. This is a good chance to split it up to keep our application easier to maintain. Especially the lane header feels like a component of its own. To get started, define <code>LaneHeader</code> based on the current code like this:</p>
<p><strong>app/components/LaneHeader.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> uuid <span class="token keyword keyword-from" >from</span> <span class="token string" >'uuid'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> connect <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/connect'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> NoteActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/NoteActions'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token keyword keyword-default" >default</span> <span class="token function" >connect</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span>
  NoteActions<span class="token punctuation" >,</span>
  LaneActions
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >,</span> LaneActions<span class="token punctuation" >,</span> NoteActions<span class="token punctuation" >,</span> <span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addNote</span> <span class="token operator" >=</span> e <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-const" >const</span> noteId <span class="token operator" >=</span> uuid<span class="token punctuation" >.</span><span class="token function" >v4</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    NoteActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      id<span class="token punctuation" >:</span> noteId<span class="token punctuation" >,</span>
      task<span class="token punctuation" >:</span> <span class="token string" >'New task'</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
    LaneActions<span class="token punctuation" >.</span><span class="token function" >attachToLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
      noteId
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token punctuation brackets-parentheses" >(</span>
    <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-header"</span> <span class="token punctuation brackets-braces" >{</span><span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-add-note"</span><span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>button onClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>addNote<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span><span class="token operator" >+</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>button<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-name"</span><span class="token operator" >&gt;</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >.</span>name<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span>
</code></pre>
<p>We also need to connect the extracted component with <code>Lane</code>:</p>
<p><strong>app/components/Lane.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-import" >import</span> React <span class="token keyword keyword-from" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
<div class="leanpub-delete">
<span class="token keyword keyword-import" >import</span> uuid <span class="token keyword keyword-from" >from</span> <span class="token string" >'uuid'</span><span class="token punctuation" >;</span>
</div>
<span class="token keyword keyword-import" >import</span> connect <span class="token keyword keyword-from" >from</span> <span class="token string" >'../libs/connect'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> NoteActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/NoteActions'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> LaneActions <span class="token keyword keyword-from" >from</span> <span class="token string" >'../actions/LaneActions'</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-import" >import</span> Notes <span class="token keyword keyword-from" >from</span> <span class="token string" >'./Notes'</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
<span class="token keyword keyword-import" >import</span> LaneHeader <span class="token keyword keyword-from" >from</span> <span class="token string" >'./LaneHeader'</span><span class="token punctuation" >;</span>
</div>

<span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >Lane</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
  lane<span class="token punctuation" >,</span> notes<span class="token punctuation" >,</span> LaneActions<span class="token punctuation" >,</span> NoteActions<span class="token punctuation" >,</span> <span class="token operator" >...</span>props
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >editNote</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span>id<span class="token punctuation" >,</span> task<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    NoteActions<span class="token punctuation" >.</span><span class="token function" >update</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>id<span class="token punctuation" >,</span> task<span class="token punctuation" >,</span> editing<span class="token punctuation" >:</span> <span class="token boolean" >false</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
<div class="leanpub-delete">
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >addNote</span> <span class="token operator" >=</span> e <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-const" >const</span> noteId <span class="token operator" >=</span> uuid<span class="token punctuation" >.</span><span class="token function" >v4</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    NoteActions<span class="token punctuation" >.</span><span class="token function" >create</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      id<span class="token punctuation" >:</span> noteId<span class="token punctuation" >,</span>
      task<span class="token punctuation" >:</span> <span class="token string" >'New task'</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
    LaneActions<span class="token punctuation" >.</span><span class="token function" >attachToLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
      noteId
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</div>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >deleteNote</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation" >,</span> e<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    e<span class="token punctuation" >.</span><span class="token function" >stopPropagation</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    LaneActions<span class="token punctuation" >.</span><span class="token function" >detachFromLane</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>
      laneId<span class="token punctuation" >:</span> lane<span class="token punctuation" >.</span>id<span class="token punctuation" >,</span>
      noteId
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
    NoteActions<span class="token punctuation" >.</span><span class="token keyword keyword-delete" >delete</span><span class="token punctuation brackets-parentheses" >(</span>noteId<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >activateNoteEdit</span> <span class="token operator" >=</span> id <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span>
    NoteActions<span class="token punctuation" >.</span><span class="token function" >update</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span>id<span class="token punctuation" >,</span> editing<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token punctuation brackets-parentheses" >(</span>
    <span class="token operator" >&lt;</span>div <span class="token punctuation brackets-braces" >{</span><span class="token operator" >...</span>props<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span>
<div class="leanpub-delete">
      <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-header"</span><span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-add-note"</span><span class="token operator" >&gt;</span>
          <span class="token operator" >&lt;</span>button onClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>addNote<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span><span class="token operator" >+</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>button<span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"lane-name"</span><span class="token operator" >&gt;</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation" >.</span>name<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
      <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
</div>
<div class="leanpub-insert">
      <span class="token operator" >&lt;</span>LaneHeader lane<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>lane<span class="token punctuation brackets-braces" >}</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
</div>
      <span class="token operator" >&lt;</span>Notes
        notes<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span><span class="token function" >selectNotesByIds</span><span class="token punctuation brackets-parentheses" >(</span>notes<span class="token punctuation" >,</span> lane<span class="token punctuation" >.</span>notes<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-braces" >}</span>
        onNoteClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>activateNoteEdit<span class="token punctuation brackets-braces" >}</span>
        onEdit<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>editNote<span class="token punctuation brackets-braces" >}</span>
        onDelete<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span>deleteNote<span class="token punctuation brackets-braces" >}</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

<span class="token operator" >...</span>
</code></pre>
<p>After these changes we have something that&#39;s a little easier to work with. It would have been possible to maintain all the related code in a single component. Often these are judgment calls as you realize there are nicer ways to split up your components. Sometimes the need for reuse or performance will force you to split.</p>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>We managed to solve the problem of handling data dependencies in this chapter. It is a problem that comes up often. Each data management solution provides a way of its own to deal with it. Flux based alternatives and Redux expect you to manage the references. Solutions like MobX have reference handling integrated. Data normalization can make these type of operations easier.</p>
<p>In the next chapter we will focus on adding missing functionality to the application. This means tackling editing lanes. We can also make the application look a little nicer again. Fortunately a lot of the logic has been developed already.</p>
</div></div><div class="page__section"><div class="social-links"><h2 class="social-links__header">Subscribe to the blog updates</h2><blockquote class="tip social-links__tip">If you enjoyed this page, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" target="_blank" class="css-1nfeoes css-va8n550"><input type="email" class="css-baseStyle-1jrw962 css-inputStyle-16d70pc" placeholder="Email" name="EMAIL" id="mce-EMAIL" required=""/><div style="display:none;position:absolute;left:-5000px"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><input type="submit" class="css-baseStyle-1jrw962 css-buttonStyle-1y781j1" value="Subscribe" name="subscribe"/></form></div><div class="css-r9vozr css-7ic71f0"><div class="css-panel-1asgzqv css-panelPrev-h368eu"><div class="css-1njlj0m css-7ic71f1">Previous chapter</div><a class="css-link-h8hsyv css-linkPrev-966ksh" href="/react/implementing-kanban/implementing-persistency/">Implementing Persistency over localStorage</a></div><div class="css-panel-1asgzqv css-panelNext-1i6c957"><div class="css-1njlj0m css-7ic71f1">Next chapter</div><a class="css-link-h8hsyv css-linkNext-1a0mc68" href="/react/implementing-kanban/editing-lanes/">Editing Lanes</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-react">available through Leanpub</a>. By purchasing the book you support the development of further content.</p></blockquote><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div><a class="next-page" title="Editing Lanes" href="/react/implementing-kanban/editing-lanes/"><i class="icon-right-open"></i></a><a class="previous-page" title="Implementing Persistency over localStorage" href="/react/implementing-kanban/implementing-persistency/"><i class="icon-left-open"></i></a></div></div></div></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a href="/">Home</a></div><div class="nav__link"><a href="/blog/">Read the blog</a></div><div class="nav__link"><a href="/maintenance/">Maintenance book</a></div><div class="nav__selected__link"><a href="/react/">React book</a></div><div class="nav__link"><a href="/webpack/">Webpack book</a></div><div class="nav__link"><a href="/training/">Hire me</a></div><div class="nav__link"><a href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><footer class="css-eo7znu css-iscbe10"><ul class="css-jtawwa css-iscbe13 css-6482o6 css-3yjlwf0"><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://twitter.com/survivejs" target="_blank" rel="noopener noreferrer">@survivejs</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://eepurl.com/bth1v5" target="_blank" rel="noopener noreferrer">Mailing List</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://gitter.im/survivejs" target="_blank" rel="noopener noreferrer">Gitter Chat</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs" target="_blank" rel="noopener noreferrer">GitHub</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://presentations.survivejs.com" target="_blank" rel="noopener noreferrer">Presentations</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank" rel="noopener noreferrer">Contact</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs/ama/issues" target="_blank" rel="noopener noreferrer">Ask Me Anything</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="/atom.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><div class="css-1gd1yml css-iscbe11"><h3 class="css-oi3rzz css-iscbe12">From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/fastpack-interview/">Fastpack - Pack JavaScript code fast and easy - Interview with Oleksiy Golovko</a></li><li><a class="blog-teaser" href="/blog/lint-staged-interview/">lint-staged - Run Linters on git Staged Files - Interview with Andrey Okonetchnikov</a></li><li><a class="blog-teaser" href="/blog/webpack-book-updated-to-webpack-4/">&quot;SurviveJS - Webpack&quot; Updated to webpack 4</a></li><li><a class="blog-teaser" href="/blog/webpack-in-munich-may-2018/">Webpack in Munich, May 2018</a></li><li><a class="blog-teaser" href="/blog/concat-2018/">Experiences on Concat 2018</a></li><li><a class="blog-teaser" href="/blog/verdaccio-interview/">Verdaccio - A lightweight npm proxy registry - Interview with Juan Picado</a></li><li><a class="blog-teaser" href="/blog/parket-interview/">Parket - A state management library inspired by mobx-state-tree - Interview with Leah Ullmann</a></li></ul></div><ul class="css-6482o6 css-3yjlwf0"><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/maintenance/introduction"><img alt="Maintenance book cover" src="/44f3a3a3dad86956efa57dea740c5d44.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-maintenance">Buy at Leanpub</a></li><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/react/introduction"><img alt="React book cover" src="/b61671d95f81496495f2587a10ddb122.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></li><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/webpack/foreword"><img alt="Webpack book cover" src="/8f86c1d07d5536454690030cd1a10b53.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/9526868803/">Buy at Amazon</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/B06XWZZGBS">Buy for Kindle</a></li></ul></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
          ((window.gitter = {}).chat = {}).options = {
            showChatByDefault: false,
            activationElement: '.gitter-open-chat-button',
            room: 'survivejs/react'
          };
        </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
        docsearch({
          apiKey: '7a7d80ba370ebaf7a9afa96ad380a1e1',
          indexName: 'survivejs_react',
          inputSelector: '#search',
          debug: false
        });
      </script></div></div>

    
  </body>
</html>
