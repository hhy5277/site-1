<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
    <meta
      name="description"
      content="
Tree shaking is a feature enabled by the ES2015 module definition. The idea is that given it&#39;s poss…" />
    <meta
      name="keywords"
      content="" />
    <meta property="og:site_name" content="SurviveJS" />
    <meta property="og:title" content="Tree Shaking" />
    <meta property="og:description" content="
Tree shaking is a feature enabled by the ES2015 module definition. The idea is that given it&#39;s poss…" />
    <meta name="twitter:title" content="Tree Shaking" />
    <meta name="twitter:description" content="
Tree shaking is a feature enabled by the ES2015 module definition. The idea is that given it&#39;s poss…" />
    <meta name="twitter:site" content="@SurviveJS" />
    <title>Tree Shaking</title>
    
    <link rel='icon' type='image/png' href='/favicon.png'></link>

    
      <link href="/site.27f90ec4451018f8bf08.css" rel="stylesheet">
    

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"
    />
  </head>
  <body>
    <div><div class="page"><div class="header-image" style="background-image:url(/13b3f0692d96a63b33bf8e3f0daf3214.jpg)"></div><h1 class="page__heading">Tree Shaking</h1><div class="header-extra"><a href="https://500px.com/photo/158267335/pines-lots-of-pines-by-juho-veps%C3%A4l%C3%A4inen">Juho Vepsäläinen (CC BY-SA)</a></div><div class="page__container"><div class="css-xfgthk css-20xtq50"><label for="sidebar-toggle" class="css-7vv0nt css-20xtq52">Table of contents</label><input type="checkbox" id="sidebar-toggle" class="css-38lglc css-20xtq53"/><div class="css-nyzxad css-20xtq51"><div class="toc-nav__wrapper"><div class="toc-nav__section"><input id="search" class="toc-nav__search" placeholder="Search"/></div><div class="toc-nav__section"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword/">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface/">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction/">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack/">What is Webpack</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing/">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started/">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/webpack-dev-server/">webpack-dev-server</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration/">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling/">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading/">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css/">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css/">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing/">Autoprefixing</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading/">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions/">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images/">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts/">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript/">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building/">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps/">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/bundle-splitting/">Bundle Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting/">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up/">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing/">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying/">Minifying</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Tree Shaking</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/environment-variables/">Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames/">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest/">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/build-analysis/">Build Analysis</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance/">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output/">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets/">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages/">Multiple Pages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/server-side-rendering/">Server Side Rendering</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques/">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading/">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers/">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n/">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing/">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying/">Deploying Applications</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/consuming/">Consuming Packages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending/">Extending</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/loaders/">Extending with Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins/">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion/">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices/">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison/">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr/">Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/css-modules/">CSS Modules</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react/">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting/">Troubleshooting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/glossary/">Glossary</a></li></ul></div><div class="toc-nav__section"></div></div></div></div><div class="page__main"><div class="page__section"><div><blockquote class="latestpost tip"><a class="latestpost-link" href="/blog/summer-2018-events/">SurviveJS - Summer Events</a></blockquote></div><div class="chapter-content"><p><strong>Tree shaking</strong> is a feature enabled by the ES2015 module definition. The idea is that given it&#39;s possible to analyze the module definition statically without running it, webpack can tell which parts of the code are being used and which are not. It&#39;s possible to verify this behavior by expanding the application and adding code there that should be eliminated.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Tree shaking works to an extent through <a href="https://www.npmjs.com/package/webpack-common-shake">webpack-common-shake</a> against CommonJS module definition. As a majority of npm packages have been authored using the older definition, the plugin has value.</blockquote><h2 class="header"><a class="header-anchor" href="#demonstrating-tree-shaking" id="demonstrating-tree-shaking"></a><span class="text">Demonstrating Tree Shaking</span><a class="header-anchor-select" href="#demonstrating-tree-shaking">#</a></h2>
<p>To shake code, you have to define a module and use only a part of its code. Set one up:</p>
<p><strong>src/shake.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >shake</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"shake"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> <span class="token function-variable function" >bake</span> <span class="token operator" >=</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"bake"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-export" >export</span> <span class="token punctuation brackets-braces" >{</span> shake<span class="token punctuation" >,</span> bake <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>To make sure you use a part of the code, alter the application entry point:</p>
<p><strong>src/index.js</strong></p>
<pre><code class="lang-javascript"><span class="token operator" >...</span>
<span class="token keyword keyword-import" >import</span> <span class="token punctuation brackets-braces" >{</span> bake <span class="token punctuation brackets-braces" >}</span> <span class="token keyword keyword-from" >from</span> <span class="token string" >"./shake"</span><span class="token punctuation" >;</span>

<span class="token function" >bake</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token operator" >...</span>
</code></pre>
<p>If you build the project again (<code>npm run build</code>) and examine the build (<em>dist/main.js</em>), it should contain <code>console.log(&quot;bake&quot;)</code>, but miss <code>console.log(&quot;shake&quot;)</code>. That&#39;s tree shaking in action.</p>
<p>To get a better idea of what webpack is using for tree shaking, run it through <code>npm run build -- --display-used-exports</code>. You should see additional output like <code>[no exports used]</code> or <code>[only some exports used: bake]</code> in the terminal.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you are using <code>UglifyJsPlugin</code>, enable warnings for a similar effect. In addition to other messages, you should see lines like <code>Dropping unused variable treeShakingDemo [./src/component.js:17,6]</code>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>There is a CSS Modules related tree shaking proof of concept at <a href="https://github.com/simlrh/dead-css-loader">dead-css-loader</a>.</blockquote><h2 class="header"><a class="header-anchor" href="#tree-shaking-on-package-level" id="tree-shaking-on-package-level"></a><span class="text">Tree Shaking on Package Level</span><a class="header-anchor-select" href="#tree-shaking-on-package-level">#</a></h2>
<p>The same idea works with dependencies that use the ES2015 module definition. Given the related packaging, standards are still emerging, you have to be careful when consuming such packages. Webpack tries to resolve <em>package.json</em> <code>module</code> field for this reason.</p>
<p>For tools like webpack to allow tree shake npm packages, you should generate a build that has transpiled everything else except the ES2015 module definitions and then point to it through <em>package.json</em> <code>module</code> field. In Babel terms, you have to let webpack to manage ES2015 modules by setting <code>&quot;modules&quot;: false</code>.</p>
<p>To get most out of tree shaking with external packages, you have to use <a href="https://www.npmjs.com/package/babel-plugin-transform-imports">babel-plugin-transform-imports</a> to rewrite imports so that they work with webpack&#39;s tree shaking logic. See <a href="https://github.com/webpack/webpack/issues/2867">webpack issue #2867</a> for more information.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><a href="https://survivejs.com/maintenance/packaging/building/">SurviveJS - Maintenance</a> covers how to write your packages so that it&#39;s possible to apply tree shaking against them.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Tree shaking is a potentially powerful technique. For the source to benefit from tree shaking, npm packages have to be implemented using the ES2015 module syntax, and they have to expose the ES2015 version through <em>package.json</em> <code>module</code> field tools like webpack can pick up.</p>
<p>To recap:</p>
<ul>
<li><strong>Tree shaking</strong> drops unused pieces of code based on static code analysis. Webpack performs this process for you as it traverses the dependency graph.</li>
<li>To benefit from tree shaking, you have to use ES2015 module definition.</li>
<li>As a package author, you can provide a version of your package that contains ES2015 modules, while the rest has been transpiled to ES5.</li>
</ul>
<p>You&#39;ll learn how to manage environment variables using webpack in the next chapter.</p>
</div></div><div class="page__section"><div class="social-links"><h2 class="social-links__header">Subscribe to the blog updates</h2><blockquote class="tip social-links__tip">If you enjoyed this page, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" target="_blank" class="css-1nfeoes css-va8n550"><input type="email" class="css-baseStyle-1jrw962 css-inputStyle-16d70pc" placeholder="Email" name="EMAIL" id="mce-EMAIL" required=""/><div style="display:none;position:absolute;left:-5000px"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><input type="submit" class="css-baseStyle-1jrw962 css-buttonStyle-1y781j1" value="Subscribe" name="subscribe"/></form></div><div class="css-r9vozr css-7ic71f0"><div class="css-panel-1asgzqv css-panelPrev-h368eu"><div class="css-1njlj0m css-7ic71f1">Previous chapter</div><a class="css-link-h8hsyv css-linkPrev-966ksh" href="/webpack/optimizing/minifying/">Minifying</a></div><div class="css-panel-1asgzqv css-panelNext-1i6c957"><div class="css-1njlj0m css-7ic71f1">Next chapter</div><a class="css-link-h8hsyv css-linkNext-1a0mc68" href="/webpack/optimizing/environment-variables/">Environment Variables</a></div></div><blockquote class="tip"><p>This book is available through <a href="https://leanpub.com/survivejs-webpack">Leanpub (digital)</a>, <a href="https://www.amazon.com/dp/9526868803">Amazon (paperback)</a>, and <a href="https://www.amazon.com/dp/B06XWZZGBS">Kindle (digital)</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of webpack.</p></blockquote><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div><a class="next-page" title="Environment Variables" href="/webpack/optimizing/environment-variables/"><i class="icon-right-open"></i></a><a class="previous-page" title="Minifying" href="/webpack/optimizing/minifying/"><i class="icon-left-open"></i></a></div></div></div></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a href="/">Home</a></div><div class="nav__link"><a href="/blog/">Read the blog</a></div><div class="nav__link"><a href="/maintenance/">Maintenance book</a></div><div class="nav__link"><a href="/react/">React book</a></div><div class="nav__selected__link"><a href="/webpack/">Webpack book</a></div><div class="nav__link"><a href="/training/">Hire me</a></div><div class="nav__link"><a href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><footer class="css-eo7znu css-iscbe10"><ul class="css-jtawwa css-iscbe13 css-6482o6 css-3yjlwf0"><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://twitter.com/survivejs" target="_blank" rel="noopener noreferrer">@survivejs</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://eepurl.com/bth1v5" target="_blank" rel="noopener noreferrer">Mailing List</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://gitter.im/survivejs" target="_blank" rel="noopener noreferrer">Gitter Chat</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs" target="_blank" rel="noopener noreferrer">GitHub</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://presentations.survivejs.com" target="_blank" rel="noopener noreferrer">Presentations</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank" rel="noopener noreferrer">Contact</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs/ama/issues" target="_blank" rel="noopener noreferrer">Ask Me Anything</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="/atom.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><div class="css-1gd1yml css-iscbe11"><h3 class="css-oi3rzz css-iscbe12">From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/summer-2018-events/">SurviveJS - Summer Events</a></li><li><a class="blog-teaser" href="/blog/fastpack-interview/">Fastpack - Pack JavaScript code fast and easy - Interview with Oleksiy Golovko</a></li><li><a class="blog-teaser" href="/blog/lint-staged-interview/">lint-staged - Run Linters on git Staged Files - Interview with Andrey Okonetchnikov</a></li><li><a class="blog-teaser" href="/blog/webpack-book-updated-to-webpack-4/">&quot;SurviveJS - Webpack&quot; Updated to webpack 4</a></li><li><a class="blog-teaser" href="/blog/webpack-in-munich-may-2018/">Webpack in Munich, May 2018</a></li><li><a class="blog-teaser" href="/blog/concat-2018/">Experiences on Concat 2018</a></li><li><a class="blog-teaser" href="/blog/verdaccio-interview/">Verdaccio - A lightweight npm proxy registry - Interview with Juan Picado</a></li></ul></div><ul class="css-6482o6 css-3yjlwf0"><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/maintenance/introduction"><img alt="Maintenance book cover" src="/44f3a3a3dad86956efa57dea740c5d44.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-maintenance">Buy at Leanpub</a></li><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/react/introduction"><img alt="React book cover" src="/b61671d95f81496495f2587a10ddb122.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></li><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/webpack/foreword"><img alt="Webpack book cover" src="/8f86c1d07d5536454690030cd1a10b53.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/9526868803/">Buy at Amazon</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/B06XWZZGBS">Buy for Kindle</a></li></ul></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
          ((window.gitter = {}).chat = {}).options = {
            showChatByDefault: false,
            activationElement: '.gitter-open-chat-button',
            room: 'survivejs/react'
          };
        </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
        docsearch({
          apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
          indexName: 'survivejs_webpack',
          inputSelector: '#search',
          debug: false
        });
      </script></div></div>

    
  </body>
</html>
