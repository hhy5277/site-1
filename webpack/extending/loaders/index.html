<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
    <meta
      name="description"
      content="
As you have seen so far, loaders are one of the building blocks of webpack. If you want to load an …" />
    <meta
      name="keywords"
      content="" />
    <meta property="og:site_name" content="SurviveJS" />
    <meta property="og:title" content="Extending with Loaders" />
    <meta property="og:description" content="
As you have seen so far, loaders are one of the building blocks of webpack. If you want to load an …" />
    <meta name="twitter:title" content="Extending with Loaders" />
    <meta name="twitter:description" content="
As you have seen so far, loaders are one of the building blocks of webpack. If you want to load an …" />
    <meta name="twitter:site" content="@SurviveJS" />
    <title>Extending with Loaders</title>
    
    <link rel='icon' type='image/png' href='/favicon.png'></link>

    
      <link href="/site.b1d2a0590f42b4320706.css" rel="stylesheet">
    

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"
    />
  </head>
  <body>
    <header class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><a title="Extending" aria-hidden="true" class="css-17k05uf css-isbjic0" href="/webpack/extending/"><i class="icon-left-open"></i></a><nav class="nav"><ul class="nav__items"><li class="nav__link"><a href="https://graphql-finland.fi/">GraphQL Finland</a></li><li class="nav__link"><a href="/">Home</a></li><li class="nav__link"><a href="/blog/">Read the blog</a></li><li class="nav__link"><a href="/maintenance/">Maintenance book</a></li><li class="nav__link"><a href="/react/">React book</a></li><li class="nav__link nav__link_selected"><a href="/webpack/">Webpack book</a></li><li class="nav__link"><a href="/training/">Hire me</a></li><li class="nav__link"><a href="https://twitter.com/survivejs">@survivejs</a></li></ul></nav><a title="Extending with Plugins" aria-hidden="true" class="css-17k05uf css-isbjic0" href="/webpack/extending/plugins/"><i class="icon-right-open"></i></a></header><div class="page"><div class="css-b5dhuc css-8rlsag0"><div style="background-image:url(/10754fcfe46ac6d5e62e476b13ed909d.jpg)" class="css-1huzfyy css-8rlsag1"></div><h1 class="css-13wbkqf css-8rlsag2">Extending with Loaders</h1><small aria-hidden="true" class="css-18xzi2i css-8rlsag3"><a href="https://pixabay.com/en/volvo-wheel-loaders-machine-906771/">jannebjo (Public Domain)</a></small></div><div class="page__container"><div class="css-xfgthk css-20xtq50"><label for="sidebar-toggle" class="css-7vv0nt css-20xtq52">Table of contents</label><input type="checkbox" id="sidebar-toggle" class="css-38lglc css-20xtq53"/><div class="css-nyzxad css-20xtq51"><div class="toc-nav__wrapper"><div class="toc-nav__section"><input id="search" class="toc-nav__search" placeholder="Search"/></div><div class="toc-nav__section"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword/">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface/">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction/">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack/">What is Webpack</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing/">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started/">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/webpack-dev-server/">webpack-dev-server</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration/">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling/">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading/">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css/">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css/">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing/">Autoprefixing</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading/">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions/">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images/">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts/">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript/">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building/">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps/">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/bundle-splitting/">Bundle Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting/">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up/">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing/">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying/">Minifying</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking/">Tree Shaking</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/environment-variables/">Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames/">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest/">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/build-analysis/">Build Analysis</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance/">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output/">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets/">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages/">Multiple Pages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/server-side-rendering/">Server Side Rendering</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques/">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading/">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers/">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n/">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing/">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying/">Deploying Applications</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/consuming/">Consuming Packages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending/">Extending</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Extending with Loaders</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins/">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion/">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices/">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison/">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr/">Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/css-modules/">CSS Modules</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react/">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting/">Troubleshooting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/glossary/">Glossary</a></li></ul></div><div class="toc-nav__section"></div></div></div></div><div class="page__main"><div class="page__section"><div><blockquote class="latestpost tip"><a class="latestpost-link" href="/blog/pwa-interview/">Progressive Web Apps - The Why and How - Interview with Maciej Caputa</a></blockquote></div><div class="chapter-content"><p>As you have seen so far, loaders are one of the building blocks of webpack. If you want to load an asset, you most likely need to set up a matching loader definition. Even though there are a lot of <a href="https://webpack.js.org/loaders/">available loaders</a>, it&#39;s possible you are missing one fitting your purposes.</p>
<p>You&#39;ll learn to develop a couple of small loaders next. But before that, it&#39;s good to understand how to debug them in isolation.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want a good starting point for a standalone loader or plugin project, consider using <a href="https://github.com/webpack-contrib/webpack-defaults">webpack-defaults</a>. It provides an opinionated starting point that comes with linting, testing, and other goodies.</blockquote><h2 class="header"><a class="header-anchor" href="#debugging-loaders-with-loader-runner-" id="debugging-loaders-with-loader-runner-"></a><span class="text">Debugging Loaders with <em>loader-runner</em></span><a class="header-anchor-select" href="#debugging-loaders-with-loader-runner-">#</a></h2>
<p><a href="https://www.npmjs.com/package/loader-runner">loader-runner</a> allows you to run loaders without webpack allowing you to learn more about loader development. Install it first:</p>
<pre><code class="lang-bash"><span class="token function" >npm</span> <span class="token function" >install</span> loader-runner --save-dev
</code></pre>
<p>To have something to test with, set up a loader that returns twice what&#39;s passed to it:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> input <span class="token operator" >=&gt;</span> input <span class="token operator" >+</span> input<span class="token punctuation" >;</span>
</code></pre>
<p>Set up a file to process:</p>
<p><strong>demo.txt</strong></p>
<pre><code>foobar
</code></pre><p>There&#39;s nothing webpack specific in the code yet. The next step is to run the loader through <em>loader-runner</em>:</p>
<p><strong>run-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> fs <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"fs"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"path"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> <span class="token punctuation brackets-braces" >{</span> runLoaders <span class="token punctuation brackets-braces" >}</span> <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"loader-runner"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token function" >runLoaders</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token punctuation brackets-braces" >{</span>
    resource<span class="token punctuation" >:</span> <span class="token string" >"./demo.txt"</span><span class="token punctuation" >,</span>
    loaders<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span>path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"./loaders/demo-loader"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
    readResource<span class="token punctuation" >:</span> fs<span class="token punctuation" >.</span>readFile<span class="token punctuation" >.</span><span class="token function" >bind</span><span class="token punctuation brackets-parentheses" >(</span>fs<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation" >,</span> result<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span>err <span class="token operator" >?</span> console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation" >:</span> console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span>result<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you run the script now (<code>node run-loader.js</code>), you should see output:</p>
<pre><code class="lang-javascript"><span class="token punctuation brackets-braces" >{</span> result<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span> <span class="token string" >'foobar\nfoobar\n'</span> <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
  resourceBuffer<span class="token punctuation" >:</span> <span class="token operator" >&lt;</span>Buffer <span class="token number" >66</span> 6f 6f <span class="token number" >62</span> <span class="token number" >61</span> <span class="token number" >72</span> 0a<span class="token operator" >&gt;</span><span class="token punctuation" >,</span>
  cacheable<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  fileDependencies<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span> <span class="token string" >'./demo.txt'</span> <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
  contextDependencies<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span> <span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>The output tells the <code>result</code> of the processing, the resource that was processed as a buffer, and other meta information. The data is enough to develop more complicated loaders.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to capture the output to a file, use either <code>fs.writeFileSync(&quot;./output.txt&quot;, result.result)</code> or its asynchronous version as discussed in <a href="https://nodejs.org/api/fs.html">Node documentation</a>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>It&#39;s possible to refer to loaders installed to the local project by name instead of resolving a full path to them. Example: <code>loaders: [&quot;raw-loader&quot;]</code>.</blockquote><h2 class="header"><a class="header-anchor" href="#implementing-an-asynchronous-loader" id="implementing-an-asynchronous-loader"></a><span class="text">Implementing an Asynchronous Loader</span><a class="header-anchor-select" href="#implementing-an-asynchronous-loader">#</a></h2>
<p>Even though you can implement a lot of loaders using the synchronous interface, there are times when an asynchronous calculation is required. Wrapping a third party package as a loader can force you to this.</p>
<p>The example above can be adapted to asynchronous form by using webpack specific API through <code>this.async()</code>. Webpack sets this, and the function returns a callback following Node conventions (error first, result second).</p>
<p>Tweak as follows:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>input<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> callback <span class="token operator" >=</span> <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token keyword keyword-async" >async</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token comment" spellcheck="true" >// No callback -&gt; return synchronous results</span>
  <span class="token comment" spellcheck="true" >// if (callback) { ... }</span>

  <span class="token function" >callback</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-null" >null</span><span class="token punctuation" >,</span> input <span class="token operator" >+</span> input<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<blockquote class="warning"><i class="icon-attention"></i>Given webpack injects its API through <code>this</code>, the shorter function form (<code>() =&gt; ...</code>) cannot be used here.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>If you want to pass a source map to webpack, give it as the third parameter of the callback.</blockquote><p>Running the demo script (<code>node run-loader.js</code>) again should give the same result as before. To raise an error during execution, try the following:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>input<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> callback <span class="token operator" >=</span> <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token keyword keyword-async" >async</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token function" >callback</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-new" >new</span> <span class="token class-name" >Error</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"Demo error"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>The result should contain <code>Error: Demo error</code> with a stack trace showing where the error originates.</p>
<h2 class="header"><a class="header-anchor" href="#returning-only-output" id="returning-only-output"></a><span class="text">Returning Only Output</span><a class="header-anchor-select" href="#returning-only-output">#</a></h2>
<p>Loaders can be used to output code alone. You could have an implementation as below:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-return" >return</span> <span class="token string" >"foobar"</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>But what&#39;s the point? You can pass to loaders through webpack entries. Instead of pointing to pre-existing files as you would in a majority of the cases, you could give to a loader that generates code dynamically.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to return <code>Buffer</code> output, set <code>module.exports.raw = true</code>. The flag overrides the default behavior which expects a string is returned.</blockquote><h2 class="header"><a class="header-anchor" href="#writing-files" id="writing-files"></a><span class="text">Writing Files</span><a class="header-anchor-select" href="#writing-files">#</a></h2>
<p>Loaders, like <em>file-loader</em>, emit files. Webpack provides a single method, <code>this.emitFile</code>, for this. Given <em>loader-runner</em> does not implement it, you have to mock it:</p>
<p><strong>run-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token operator" >...</span>

<span class="token function" >runLoaders</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token punctuation brackets-braces" >{</span>
    resource<span class="token punctuation" >:</span> <span class="token string" >"./demo.txt"</span><span class="token punctuation" >,</span>
    loaders<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span>path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"./loaders/demo-loader"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
    context<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
      emitFile<span class="token punctuation" >:</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
</div>
    readResource<span class="token punctuation" >:</span> fs<span class="token punctuation" >.</span>readFile<span class="token punctuation" >.</span><span class="token function" >bind</span><span class="token punctuation brackets-parentheses" >(</span>fs<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation" >,</span> result<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span>err <span class="token operator" >?</span> console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation" >:</span> console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span>result<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>To implement the essential idea of <em>file-loader</em>, you have to do two things: emit the file and return path to it. You could apply it as below:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> loaderUtils <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"loader-utils"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>content<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> url <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >interpolateName</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >,</span> <span class="token string" >"[hash].[ext]"</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span>
    content<span class="token punctuation" >,</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token function" >emitFile</span><span class="token punctuation brackets-parentheses" >(</span>url<span class="token punctuation" >,</span> content<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-const" >const</span> path <span class="token operator" >=</span> <span class="token template-string" ><span class="token string" >`__webpack_public_path__ + </span><span class="token interpolation" ><span class="token interpolation-punctuation punctuation" >${</span>JSON<span class="token punctuation" >.</span><span class="token function" >stringify</span><span class="token punctuation brackets-parentheses" >(</span>url<span class="token punctuation brackets-parentheses" >)</span><span class="token interpolation-punctuation punctuation" >}</span></span><span class="token string" >;`</span></span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token template-string" ><span class="token string" >`export default </span><span class="token interpolation" ><span class="token interpolation-punctuation punctuation" >${</span>path<span class="token interpolation-punctuation punctuation" >}</span></span><span class="token string" >`</span></span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Webpack provides two additional <code>emit</code> methods:</p>
<ul>
<li><code>this.emitWarning(&lt;string&gt;)</code></li>
<li><code>this.emitError(&lt;string&gt;)</code></li>
</ul>
<p>These calls should be used over <code>console</code> based alternatives. As with <code>this.emitFile</code>, you have to mock them for <em>loader-runner</em> to work.</p>
<p>The next question is, how to pass a file name to the loader.</p>
<h2 class="header"><a class="header-anchor" href="#passing-options-to-loaders" id="passing-options-to-loaders"></a><span class="text">Passing Options to Loaders</span><a class="header-anchor-select" href="#passing-options-to-loaders">#</a></h2>
<p>To demonstrate passing options, the runner needs a small tweak:</p>
<p><strong>run-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> fs <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"fs"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"path"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> <span class="token punctuation brackets-braces" >{</span> runLoaders <span class="token punctuation brackets-braces" >}</span> <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"loader-runner"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token function" >runLoaders</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token punctuation brackets-braces" >{</span>
    resource<span class="token punctuation" >:</span> <span class="token string" >"./demo.txt"</span><span class="token punctuation" >,</span>
<div class="leanpub-delete">
    loaders<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span>path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"./loaders/demo-loader"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
</div>
<div class="leanpub-insert">
    loaders<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span>
      <span class="token punctuation brackets-braces" >{</span>
        loader<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"./loaders/demo-loader"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
        options<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
          name<span class="token punctuation" >:</span> <span class="token string" >"demo.[ext]"</span><span class="token punctuation" >,</span>
        <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
      <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
    <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
</div>
    context<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
      emitFile<span class="token punctuation" >:</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-braces" >{</span><span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
    readResource<span class="token punctuation" >:</span> fs<span class="token punctuation" >.</span>readFile<span class="token punctuation" >.</span><span class="token function" >bind</span><span class="token punctuation brackets-parentheses" >(</span>fs<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation" >,</span> result<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span>err <span class="token operator" >?</span> console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation" >:</span> console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span>result<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>To capture the option, you need to use <a href="https://www.npmjs.com/package/loader-utils">loader-utils</a>. It has been designed to parse loader options and queries. Install it:</p>
<pre><code class="lang-bash"><span class="token function" >npm</span> <span class="token function" >install</span> loader-utils --save-dev
</code></pre>
<p>To connect it to the loader, set it to capture <code>name</code> and pass it through webpack&#39;s interpolator:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> loaderUtils <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"loader-utils"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>content<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
<div class="leanpub-insert">
  <span class="token keyword keyword-const" >const</span> <span class="token punctuation brackets-braces" >{</span> name <span class="token punctuation brackets-braces" >}</span> <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >getOptions</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
<div class="leanpub-delete">
  <span class="token keyword keyword-const" >const</span> url <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >interpolateName</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >,</span> <span class="token string" >"[hash].[ext]"</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span>
    content<span class="token punctuation" >,</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
<div class="leanpub-insert">
  <span class="token keyword keyword-const" >const</span> url <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >interpolateName</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >,</span> name<span class="token punctuation" >,</span> <span class="token punctuation brackets-braces" >{</span> content <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token operator" >...</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>After running (<code>node ./run-loader.js</code>), you should see something:</p>
<pre><code class="lang-javascript"><span class="token punctuation brackets-braces" >{</span> result<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span> <span class="token string" >'export default __webpack_public_path__+"demo.txt";'</span> <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
  resourceBuffer<span class="token punctuation" >:</span> <span class="token operator" >&lt;</span>Buffer <span class="token number" >66</span> 6f 6f <span class="token number" >62</span> <span class="token number" >61</span> <span class="token number" >72</span> 0a<span class="token operator" >&gt;</span><span class="token punctuation" >,</span>
  cacheable<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  fileDependencies<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span> <span class="token string" >'./demo.txt'</span> <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
  contextDependencies<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span> <span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>You can see that the result matches what the loader should have returned. You can try to pass more options to the loader or use query parameters to see what happens with different combinations.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>It&#39;s a good idea to validate options and rather fail hard than silently if the options aren&#39;t what you expect. <a href="https://www.npmjs.com/package/schema-utils">schema-utils</a> has been designed for this purpose.</blockquote><h2 class="header"><a class="header-anchor" href="#connecting-custom-loaders-with-webpack" id="connecting-custom-loaders-with-webpack"></a><span class="text">Connecting Custom Loaders with Webpack</span><a class="header-anchor-select" href="#connecting-custom-loaders-with-webpack">#</a></h2>
<p>To get most out of loaders, you have to connect them with webpack. To achieve this, you can go through imports:</p>
<p><strong>src/component.js</strong></p>
<pre><code class="lang-javascript"><div class="leanpub-insert">
<span class="token keyword keyword-import" >import</span> <span class="token string" >"!../loaders/demo-loader?name=foo!./main.css"</span><span class="token punctuation" >;</span>
</div>
</code></pre>
<p>Given the definition is verbose, the loader can be aliased as below:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> commonConfig <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-square" >[</span>
  <span class="token punctuation brackets-braces" >{</span>
  <span class="token operator" >...</span>
<div class="leanpub-insert">
    resolveLoader<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
      alias<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
        <span class="token string" >"demo-loader"</span><span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation brackets-parentheses" >(</span>
          __dirname<span class="token punctuation" >,</span>
          <span class="token string" >"loaders/demo-loader.js"</span>
        <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
      <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
</div>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  <span class="token operator" >...</span>
<span class="token punctuation brackets-square" >]</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>With this change the import can be simplified:</p>
<pre><code class="lang-javascript"><div class="leanpub-delete">
<span class="token keyword keyword-import" >import</span> <span class="token string" >"!../loaders/demo-loader?name=foo!./main.css"</span><span class="token punctuation" >;</span>
</div>
<div class="leanpub-insert">
<span class="token keyword keyword-import" >import</span> <span class="token string" >"!demo-loader?name=foo!./main.css"</span><span class="token punctuation" >;</span>
</div>
</code></pre>
<p>You could also handle the loader definition through <code>rules</code>. Once the loader is stable enough, set up a project based on <em>webpack-defaults</em>, push the logic there, and begin to consume the loader as a package.</p>
<blockquote class="warning"><i class="icon-attention"></i>Although using <em>loader-runner</em> can be convenient for developing and testing loaders, implement integration tests that run against webpack. Subtle differences between environments make this essential.</blockquote><h2 class="header"><a class="header-anchor" href="#pitch-loaders" id="pitch-loaders"></a><span class="text">Pitch Loaders</span><a class="header-anchor-select" href="#pitch-loaders">#</a></h2>
<p><figure><img src="/23ffe365f20592287b5b0ef2ef282684.png" alt="Webpack loader processing" class="" width="" height="" /><figcaption>Webpack loader processing</figcaption></figure></p>
<p>Webpack evaluates loaders in two phases: pitching and evaluating. If you are used to web event semantics, these map to capturing and bubbling. The idea is that webpack allows you to intercept execution during the pitching (capturing) phase. It goes through the loaders left to right first and executes them from right to left after that.</p>
<p>A pitch loader allows you shape the request and even terminate it. Set it up:</p>
<p><strong>loaders/pitch-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> loaderUtils <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"loader-utils"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>input<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> <span class="token punctuation brackets-braces" >{</span> text <span class="token punctuation brackets-braces" >}</span> <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >getOptions</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> input <span class="token operator" >+</span> text<span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
module<span class="token punctuation" >.</span>exports<span class="token punctuation" >.</span><span class="token function-variable function" >pitch</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>remainingReq<span class="token punctuation" >,</span> precedingReq<span class="token punctuation" >,</span> input<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span><span class="token template-string" ><span class="token string" >`
Remaining request: </span><span class="token interpolation" ><span class="token interpolation-punctuation punctuation" >${</span>remainingReq<span class="token interpolation-punctuation punctuation" >}</span></span><span class="token string" >
Preceding request: </span><span class="token interpolation" ><span class="token interpolation-punctuation punctuation" >${</span>precedingReq<span class="token interpolation-punctuation punctuation" >}</span></span><span class="token string" >
Input: </span><span class="token interpolation" ><span class="token interpolation-punctuation punctuation" >${</span>JSON<span class="token punctuation" >.</span><span class="token function" >stringify</span><span class="token punctuation brackets-parentheses" >(</span>input<span class="token punctuation" >,</span> <span class="token keyword keyword-null" >null</span><span class="token punctuation" >,</span> <span class="token number" >2</span><span class="token punctuation brackets-parentheses" >)</span><span class="token interpolation-punctuation punctuation" >}</span></span><span class="token string" >
  `</span></span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> <span class="token string" >"pitched"</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>To connect it to the runner, add it to the loader definition:</p>
<p><strong>run-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token function" >runLoaders</span><span class="token punctuation brackets-parentheses" >(</span>
  <span class="token punctuation brackets-braces" >{</span>
    resource<span class="token punctuation" >:</span> <span class="token string" >"./demo.txt"</span><span class="token punctuation" >,</span>
    loaders<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span>
      <span class="token operator" >...</span>
<div class="leanpub-insert">
      path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"./loaders/pitch-loader"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
</div>
    <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
    <span class="token operator" >...</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation" >,</span> result<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token punctuation brackets-parentheses" >(</span>err <span class="token operator" >?</span> console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation brackets-parentheses" >(</span>err<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation" >:</span> console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation brackets-parentheses" >(</span>result<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span>
<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you run (<code>node ./run-loader.js</code>) now, the pitch loader should log intermediate data and intercept the execution:</p>
<pre><code class="lang-javascript">Remaining request<span class="token punctuation" >:</span> <span class="token punctuation" >.</span><span class="token operator" >/</span>demo<span class="token punctuation" >.</span>txt
Preceding request<span class="token punctuation" >:</span> <span class="token operator" >...</span><span class="token operator" >/</span>webpack<span class="token operator" >-</span>demo<span class="token operator" >/</span>loaders<span class="token operator" >/</span>demo<span class="token operator" >-</span>loader<span class="token operator" >?</span><span class="token punctuation brackets-braces" >{</span><span class="token string" >"name"</span><span class="token punctuation" >:</span><span class="token string" >"demo.[ext]"</span><span class="token punctuation brackets-braces" >}</span>
Input<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span><span class="token punctuation brackets-braces" >}</span>

<span class="token punctuation brackets-braces" >{</span> result<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span> <span class="token string" >'export default __webpack_public_path__ + "demo.txt";'</span> <span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
  resourceBuffer<span class="token punctuation" >:</span> <span class="token keyword keyword-null" >null</span><span class="token punctuation" >,</span>
  cacheable<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  fileDependencies<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation" >,</span>
  contextDependencies<span class="token punctuation" >:</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span> <span class="token punctuation brackets-braces" >}</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#caching-with-loaders" id="caching-with-loaders"></a><span class="text">Caching with Loaders</span><a class="header-anchor-select" href="#caching-with-loaders">#</a></h2>
<p>Although webpack caches loaders by default unless they set <code>this.cacheable(false)</code>, writing a caching loader can be a good exercise as it helps you to understand how loader stages can work together. The example below shows how to achieve this (courtesy of Vladimir Grenaderov):</p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> cache <span class="token operator" >=</span> <span class="token keyword keyword-new" >new</span> <span class="token class-name" >Map</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span><span class="token function-variable function" >exports</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span>content<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token comment" spellcheck="true" >// Calls only once for given resourcePath</span>
  <span class="token keyword keyword-const" >const</span> callbacks <span class="token operator" >=</span> cache<span class="token punctuation" >.</span><span class="token keyword keyword-get" >get</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>resourcePath<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  callbacks<span class="token punctuation" >.</span><span class="token function" >forEach</span><span class="token punctuation brackets-parentheses" >(</span>callback <span class="token operator" >=&gt;</span> <span class="token function" >callback</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-null" >null</span><span class="token punctuation" >,</span> content<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  cache<span class="token punctuation" >.</span><span class="token keyword keyword-set" >set</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>resourcePath<span class="token punctuation" >,</span> content<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword keyword-return" >return</span> content<span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
module<span class="token punctuation" >.</span>exports<span class="token punctuation" >.</span><span class="token function-variable function" >pitch</span> <span class="token operator" >=</span> <span class="token keyword keyword-function" >function</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-if" >if</span> <span class="token punctuation brackets-parentheses" >(</span>cache<span class="token punctuation" >.</span><span class="token function" >has</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>resourcePath<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token keyword keyword-const" >const</span> item <span class="token operator" >=</span> cache<span class="token punctuation" >.</span><span class="token keyword keyword-get" >get</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>resourcePath<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword keyword-if" >if</span> <span class="token punctuation brackets-parentheses" >(</span>item <span class="token keyword keyword-instanceof" >instanceof</span> <span class="token class-name" >Array</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
      <span class="token comment" spellcheck="true" >// Load to cache</span>
      item<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span><span class="token keyword keyword-async" >async</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation brackets-braces" >}</span> <span class="token keyword keyword-else" >else</span> <span class="token punctuation brackets-braces" >{</span>
      <span class="token comment" spellcheck="true" >// Hit cache</span>
      <span class="token keyword keyword-return" >return</span> item<span class="token punctuation" >;</span>
    <span class="token punctuation brackets-braces" >}</span>
  <span class="token punctuation brackets-braces" >}</span> <span class="token keyword keyword-else" >else</span> <span class="token punctuation brackets-braces" >{</span>
    <span class="token comment" spellcheck="true" >// Missed cache</span>
    cache<span class="token punctuation" >.</span><span class="token keyword keyword-set" >set</span><span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-this" >this</span><span class="token punctuation" >.</span>resourcePath<span class="token punctuation" >,</span> <span class="token punctuation brackets-square" >[</span><span class="token punctuation brackets-square" >]</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation brackets-braces" >}</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>A pitch loader can be used to attach metadata to the input to use later. In this example, a cache was constructed during the pitching stage, and it was accessed during normal execution.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>The <a href="https://webpack.js.org/api/loaders/">official documentation</a> covers the loader API in detail. You can see all fields available through <code>this</code> there.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Writing loaders is fun in the sense that they describe transformations from a format to another. Often you can figure out how to achieve something specific by either studying either the API documentation or the existing loaders.</p>
<p>To recap:</p>
<ul>
<li><em>loader-runner</em> is a valuable tool for understanding how loaders work. Use it for debugging how loaders work.</li>
<li>Webpack <strong>loaders</strong> accept input and produce output based on it.</li>
<li>Loaders can be either synchronous or asynchronous. In the latter case, you should use <code>this.async()</code> webpack API to capture the callback exposed by webpack.</li>
<li>If you want to generate code dynamically for webpack entries, that&#39;s where loaders can come in handy. A loader does not have to accept input. It&#39;s acceptable that it returns only output in this case.</li>
<li>Use <strong>loader-utils</strong> to parse possible options passed to a loader and consider validating them using <strong>schema-utils</strong>.</li>
<li>When developing loaders locally, consider setting up a <code>resolveLoader.alias</code> to clean up references.</li>
<li>Pitching stage complements the default behavior allowing you to intercept and to attach metadata.</li>
</ul>
<p>You&#39;ll learn to write plugins in the next chapter. Plugins allow you to intercept webpack&#39;s execution process and they can be combined with loaders to develop more advanced functionality.</p>
</div></div><div class="page__section"><div class="social-links"><h2 class="social-links__header">Subscribe to the blog updates</h2><blockquote class="tip social-links__tip">If you enjoyed this page, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" target="_blank" class="css-1nfeoes css-va8n550"><input type="email" class="css-baseStyle-1jrw962 css-inputStyle-16d70pc" placeholder="Email" name="EMAIL" id="mce-EMAIL" required=""/><div style="display:none;position:absolute;left:-5000px"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><input type="submit" class="css-baseStyle-1jrw962 css-buttonStyle-1y781j1" value="Subscribe" name="subscribe"/></form></div><div class="css-r9vozr css-7ic71f0"><div class="css-panel-1asgzqv css-panelPrev-h368eu"><div class="css-1njlj0m css-7ic71f1">Previous chapter</div><a class="css-link-h8hsyv css-linkPrev-966ksh" href="/webpack/extending/">Extending</a></div><div class="css-panel-1asgzqv css-panelNext-1i6c957"><div class="css-1njlj0m css-7ic71f1">Next chapter</div><a class="css-link-h8hsyv css-linkNext-1a0mc68" href="/webpack/extending/plugins/">Extending with Plugins</a></div></div><blockquote class="tip"><p>This book is available through <a href="https://leanpub.com/survivejs-webpack">Leanpub (digital)</a>, <a href="https://www.amazon.com/dp/9526868803">Amazon (paperback)</a>, and <a href="https://www.amazon.com/dp/B06XWZZGBS">Kindle (digital)</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of webpack.</p></blockquote><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div></div></div></div><footer class="css-eo7znu css-iscbe10"><ul class="css-jtawwa css-iscbe13 css-6482o6 css-3yjlwf0"><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://twitter.com/survivejs" target="_blank" rel="noopener noreferrer">@survivejs</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://eepurl.com/bth1v5" target="_blank" rel="noopener noreferrer">Mailing List</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://gitter.im/survivejs" target="_blank" rel="noopener noreferrer">Gitter Chat</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs" target="_blank" rel="noopener noreferrer">GitHub</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://presentations.survivejs.com" target="_blank" rel="noopener noreferrer">Presentations</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank" rel="noopener noreferrer">Contact</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs/ama/issues" target="_blank" rel="noopener noreferrer">Ask Me Anything</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="/atom.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><div class="css-1gd1yml css-iscbe11"><h3 class="css-oi3rzz css-iscbe12">From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/pwa-interview/">Progressive Web Apps - The Why and How - Interview with Maciej Caputa</a></li><li><a class="blog-teaser" href="/blog/proppy-interview/">Proppy - Functional props composition for components - Interview with Fahad Ibnay Heylaal</a></li><li><a class="blog-teaser" href="/blog/summer-2018-events/">SurviveJS - Summer Events</a></li><li><a class="blog-teaser" href="/blog/fastpack-interview/">Fastpack - Pack JavaScript code fast and easy - Interview with Oleksiy Golovko</a></li><li><a class="blog-teaser" href="/blog/lint-staged-interview/">lint-staged - Run Linters on git Staged Files - Interview with Andrey Okonetchnikov</a></li><li><a class="blog-teaser" href="/blog/webpack-book-updated-to-webpack-4/">&quot;SurviveJS - Webpack&quot; Updated to webpack 4</a></li><li><a class="blog-teaser" href="/blog/webpack-in-munich-may-2018/">Webpack in Munich, May 2018</a></li></ul></div><ul class="css-6482o6 css-3yjlwf0"><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/maintenance/introduction"><img alt="Maintenance book cover" src="/44f3a3a3dad86956efa57dea740c5d44.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-maintenance">Buy at Leanpub</a></li><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/react/introduction"><img alt="React book cover" src="/b61671d95f81496495f2587a10ddb122.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></li><li class="css-jtawwa css-3bvg0c0 css-10ozgd1 css-17pd6qu0"><a href="/webpack/foreword"><img alt="Webpack book cover" src="/8f86c1d07d5536454690030cd1a10b53.png" width="255" height="329" class="css-1d87hyi css-3bvg0c1"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/9526868803/">Buy at Amazon</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/B06XWZZGBS">Buy for Kindle</a></li></ul></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
          ((window.gitter = {}).chat = {}).options = {
            showChatByDefault: false,
            activationElement: '.gitter-open-chat-button',
            room: 'survivejs/react'
          };
        </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
        docsearch({
          apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
          indexName: 'survivejs_webpack',
          inputSelector: '#search',
          debug: false
        });
      </script></div>

    
  </body>
</html>
