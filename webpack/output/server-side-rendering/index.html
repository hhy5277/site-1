<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
    <meta
      name="description"
      content="" />
    <meta
      name="keywords"
      content="" />
    <title>Server Side Rendering</title>
    
    <link rel='icon' type='image/png' href='/favicon.png'></link>

    
      <link href="/site.9bd6e6040fbd5fd17980.css" rel="stylesheet">
    

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"
    />
  </head>
  <body>
    <div><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/363f7aaeb17b7fdd689d1cbb34f2252b.jpg);"></div><h1 class="post__heading">Server Side Rendering</h1><div class="header-extra"><a href="https://pixabay.com/en/technology-servers-server-1587673/">heladodementa (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword/">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface/">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction/">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack/">What is Webpack</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing/">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started/">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/automatic-browser-refresh/">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/linting/">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration/">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling/">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading/">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css/">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing/">Autoprefixing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css/">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/linting/">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading/">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions/">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images/">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts/">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript/">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building/">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps/">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/bundle-splitting/">Bundle Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting/">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up/">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing/">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying/">Minifying</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking/">Tree Shaking</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/environment-variables/">Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames/">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest/">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/analyzing-build-statistics/">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance/">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output/">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets/">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/bundling-libraries/">Bundling Libraries</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/library-output/">Library Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages/">Multiple Pages</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Server Side Rendering</span></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques/">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading/">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers/">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n/">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing/">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying/">Deploying Applications</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/packages/">Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming/">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming-techniques/">Package Consuming Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring/">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring-techniques/">Package Authoring Techniques</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending/">Extending</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/loaders/">Extending with Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins/">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion/">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices/">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison/">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr/">Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr-with-react/">Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint/">Customizing ESLint</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react/">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting/">Troubleshooting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/glossary/">Glossary</a></li></ul><div><div class="buy-container"><a href="/webpack/foreword"><img alt="Webpack book cover" class="sidebar-cover" src="/8f86c1d07d5536454690030cd1a10b53.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a><a class="btn btn--normal btn--buy" href="https://www.amazon.com/dp/9526868803/">Buy at Amazon</a><a class="btn btn--normal btn--buy" href="https://www.amazon.com/dp/B06XWZZGBS">Buy for Kindle</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img alt="React book cover" class="sidebar-cover" src="/b61671d95f81496495f2587a10ddb122.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><div><blockquote class="latestpost tip"><a class="latestpost-link" href="/blog/unexpected-react-interview/">unexpected-react - Test Full Virtual DOM - Interview with Dave Brotherstone</a></blockquote></div><div class="chapter-content"><p><strong>Server Side Rendering</strong> (SSR) is a technique that allows you to serve an initial payload with HTML, JavaScript, CSS, and even application state. You serve a fully rendered HTML page that would make sense even without JavaScript enabled. In addition to providing potential performance benefits, this can help with Search Engine Optimization (SEO).</p>
<p>Even though the idea does not sound that special, there is a technical cost involved, and you can find sharp corners. The approach was popularized by React. Since then frameworks encapsulating the tricky bits, such as <a href="https://www.npmjs.com/package/next">Next.js</a>, have appeared. <a href="https://www.npmjs.com/package/isomorphic-webpack">isomorphic-webpack</a> is a good example of a solution designed on top of webpack.</p>
<p>To demonstrate SSR, you can use webpack to compile a client-side build that then gets picked up by a server that renders it using React following the principle. This is enough to understand how it works and also where the problems begin.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-babel-with-react" id="setting-up-babel-with-react"></a><span class="text">Setting Up Babel with React</span><a class="header-anchor-select" href="#setting-up-babel-with-react">#</a></h2>
<p>The <a href="/webpack/loading/javascript/">Loading JavaScript</a> chapter covers the essentials of using Babel with webpack. There&#39;s setup that is particular to React you should perform, though. Given most of React projects rely on <a href="https://facebook.github.io/jsx/">JSX</a> format, you have to enable it through Babel.</p>
<p>To get React, and particularly JSX, work with Babel, install the preset first:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> babel-preset-react --save-dev
</code></pre>
<p>Connect the preset with Babel configuration as follows:</p>
<p><strong>.babelrc</strong></p>
<pre><code class="lang-json"><span class="token punctuation" >{</span>
  ...
  <span class="token property" >"presets"</span><span class="token operator" >:</span> <span class="token punctuation" >[</span>
<div class="leanpub-insert">
    <span class="token string" >"react"</span><span class="token punctuation" >,</span>
</div>
    ...
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#configuring-react-with-eslint" id="configuring-react-with-eslint"></a><span class="text">Configuring React with ESLint</span><a class="header-anchor-select" href="#configuring-react-with-eslint">#</a></h2>
<p>Using React with ESLint and JSX requires extra work as well. <a href="https://www.npmjs.com/package/eslint-plugin-react">eslint-plugin-react</a> does a part of the work, but also ESLint configuration is needed.</p>
<p>Install <em>eslint-plugin-react</em> to get started:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> eslint-plugin-react --save-dev
</code></pre>
<p>The suggested minimum configuration is as follows:</p>
<p><strong>.eslintrc.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-delete">
  <span class="token keyword" >extends</span><span class="token punctuation" >:</span> <span class="token string" >'eslint:recommended'</span><span class="token punctuation" >,</span>
</div>
<div class="leanpub-insert">
  <span class="token keyword" >extends</span><span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'eslint:recommended'</span><span class="token punctuation" >,</span> <span class="token string" >'plugin:react/recommended'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
</div>
  parser<span class="token punctuation" >:</span> <span class="token string" >'babel-eslint'</span><span class="token punctuation" >,</span>
  parserOptions<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    sourceType<span class="token punctuation" >:</span> <span class="token string" >'module'</span><span class="token punctuation" >,</span>
    allowImportExportEverywhere<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>

<div class="leanpub-insert">
    <span class="token comment" spellcheck="true">// Enable JSX</span>
    ecmaFeatures<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      jsx<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token string" >'react'</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
</div>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p><code>plugin:react/recommended</code> gives a good starting point. It&#39;s important to remember to enable JSX at the <code>parserOptions</code> as otherwise it will fail to parse JSX syntax.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-react-demo" id="setting-up-a-react-demo"></a><span class="text">Setting Up a React Demo</span><a class="header-anchor-select" href="#setting-up-a-react-demo">#</a></h2>
<p>To make sure the project has the dependencies in place, install React and <a href="https://www.npmjs.com/package/react-dom">react-dom</a>. The latter package is needed to render the application to the DOM.</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> react react-dom --save
</code></pre>
<p>Next, the React code needs a small entry point. If you are on the browser side, you should mount <code>Hello world</code> <code>div</code> to the document. To prove it works, clicking it should give a dialog with a &quot;hello&quot; message. On server-side the React component is returned so the server can pick it up.</p>
<p>Adjust as follows:</p>
<p><strong>app/ssr.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> React <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'react'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> ReactDOM <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'react-dom'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> SSR <span class="token operator" >=</span> <span class="token operator" >&lt;</span>div onClick<span class="token operator" >=</span><span class="token punctuation" >{</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token function" >alert</span><span class="token punctuation" >(</span><span class="token string" >'hello'</span><span class="token punctuation" >)</span><span class="token punctuation" >}</span><span class="token operator" >></span>Hello world<span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >></span><span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Render only in the browser, export otherwise</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token keyword" >typeof</span> document <span class="token operator" >===</span> <span class="token string" >'undefined'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> SSR<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
  ReactDOM<span class="token punctuation" >.</span><span class="token function" >render</span><span class="token punctuation" >(</span>SSR<span class="token punctuation" >,</span> document<span class="token punctuation" >.</span><span class="token function" >getElementById</span><span class="token punctuation" >(</span><span class="token string" >'app'</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>You are still missing webpack configuration to turn this file into something the server can pick up.</p>
<blockquote class="warning"><i class="icon-attention"></i>Given ES6 style imports and CommonJS exports cannot be mixed, the entry point was written in CommonJS style.</blockquote><h2 class="header"><a class="header-anchor" href="#configuring-webpack" id="configuring-webpack"></a><span class="text">Configuring Webpack</span><a class="header-anchor-select" href="#configuring-webpack">#</a></h2>
<p>To keep things nice and tidy, it&#39;s possible to push the demo configuration to a file of its own. A lot of the work has been done already. Given you have to consume the same output from multiple environments, using UMD as the library target makes sense:</p>
<p><strong>webpack.ssr.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'path'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> merge <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack-merge'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> parts <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./webpack.parts'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> PATHS <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  build<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'static'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  ssrDemo<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'app'</span><span class="token punctuation" >,</span> <span class="token string" >'ssr.js'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  <span class="token punctuation" >{</span>
    entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      index<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>ssrDemo<span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >'[name].js'</span><span class="token punctuation" >,</span>
      libraryTarget<span class="token punctuation" >:</span> <span class="token string" >'umd'</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >loadJavaScript</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>ssrDemo <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>To make it convenient to generate a build, add a helper script:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
  "build<span class="token operator" >:</span>ssr"<span class="token operator" >:</span> <span class="token string" >"webpack --config webpack.ssr.js"</span><span class="token punctuation" >,</span>
</div>
  ...
<span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</code></pre>
<p>If you build the SSR demo (<code>npm run build:ssr</code>), you should see a new file at <em>./static/index.js</em>. The next step is to set up a server to render it.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-server" id="setting-up-a-server"></a><span class="text">Setting Up a Server</span><a class="header-anchor-select" href="#setting-up-a-server">#</a></h2>
<p>To keep things clear to understand, you can set up a standalone Express server that picks up the generated bundle and renders it following the SSR principle. Install Express first:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> express --save-dev
</code></pre>
<p>Then, to get something running, implement a server as follows:</p>
<p><strong>server.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> express <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'express'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> <span class="token punctuation" >{</span> renderToString <span class="token punctuation" >}</span> <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'react-dom/server'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> SSR <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./static'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token function" >server</span><span class="token punctuation" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>PORT <span class="token operator" >||</span> <span class="token number" >8080</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >function</span> <span class="token function" >server</span><span class="token punctuation" >(</span>port<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> app <span class="token operator" >=</span> <span class="token function" >express</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  app<span class="token punctuation" >.</span><span class="token function" >use</span><span class="token punctuation" >(</span>express<span class="token punctuation" >.</span><span class="token keyword" >static</span><span class="token punctuation" >(</span><span class="token string" >'static'</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  app<span class="token punctuation" >.</span><span class="token keyword" >get</span><span class="token punctuation" >(</span><span class="token string" >'/'</span><span class="token punctuation" >,</span> <span class="token punctuation" >(</span>req<span class="token punctuation" >,</span> res<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> res<span class="token punctuation" >.</span><span class="token function" >status</span><span class="token punctuation" >(</span><span class="token number" >200</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >send</span><span class="token punctuation" >(</span>
    <span class="token function" >renderMarkup</span><span class="token punctuation" >(</span><span class="token function" >renderToString</span><span class="token punctuation" >(</span>SSR<span class="token punctuation" >)</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  app<span class="token punctuation" >.</span><span class="token function" >listen</span><span class="token punctuation" >(</span>port<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >function</span> <span class="token function" >renderMarkup</span><span class="token punctuation" >(</span>html<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> `<span class="token operator" >&lt;</span><span class="token operator" >!</span>DOCTYPE html<span class="token operator" >></span>
<span class="token operator" >&lt;</span>html<span class="token operator" >></span>
  <span class="token operator" >&lt;</span>head<span class="token operator" >></span>
    <span class="token operator" >&lt;</span>title<span class="token operator" >></span>Webpack SSR Demo<span class="token operator" >&lt;</span><span class="token operator" >/</span>title<span class="token operator" >></span>
    <span class="token operator" >&lt;</span>meta charset<span class="token operator" >=</span><span class="token string" >"utf-8"</span> <span class="token operator" >/</span><span class="token operator" >></span>
  <span class="token operator" >&lt;</span><span class="token operator" >/</span>head<span class="token operator" >></span>
  <span class="token operator" >&lt;</span>body<span class="token operator" >></span>
    <span class="token operator" >&lt;</span>div id<span class="token operator" >=</span><span class="token string" >"app"</span><span class="token operator" >></span>$<span class="token punctuation" >{</span>html<span class="token punctuation" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >></span>
    <span class="token operator" >&lt;</span>script src<span class="token operator" >=</span><span class="token string" >"./index.js"</span><span class="token operator" >></span><span class="token operator" >&lt;</span><span class="token operator" >/</span>script<span class="token operator" >></span>
  <span class="token operator" >&lt;</span><span class="token operator" >/</span>body<span class="token operator" >></span>
<span class="token operator" >&lt;</span><span class="token operator" >/</span>html<span class="token operator" >></span>`<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Run the server now (<code>node ./server.js</code>) and go below <code>http://localhost:8080</code>, you should see something familiar:</p>
<p><img src="/269f6006ae745ead9a1ba1c57ec37223.png" alt="Hello world" class="" width="" height="" /></p>
<p>Even though there is a basic React application running now, it&#39;s difficult to develop. If you try to modify the code, nothing happens. This can be solved running webpack in a multi-compiler mode as earlier in this book. Another option is to run webpack in <strong>watch mode</strong> against the current configuration and set up a watcher for the server. You&#39;ll learn the latter setup next.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to debug output from the server, set <code>export DEBUG=express:application</code>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>The references to the assets generated by webpack could be written automatically to the server side template if you wrote a manifest as discussed in the <a href="/webpack/optimizing/separating-manifest/">Separating a Manifest</a> chapter.</blockquote><blockquote class="warning"><i class="icon-attention"></i>If you get a linting warning like <code>warning  &#39;React&#39; is defined but never used  no-unused-vars</code>, make sure the ESLint React plugin has been enabled and its default preset is in use.</blockquote><h2 class="header"><a class="header-anchor" href="#watching-ssr-changes-and-refreshing-the-browser" id="watching-ssr-changes-and-refreshing-the-browser"></a><span class="text">Watching SSR Changes and Refreshing the Browser</span><a class="header-anchor-select" href="#watching-ssr-changes-and-refreshing-the-browser">#</a></h2>
<p>The first portion of the problem is fast to solve. Run <code>npm run build:ssr -- --watch</code> in a terminal. That forces webpack to run in a watch mode. It would be possible to wrap this idea within an npm script for convenience, but this is enough for this demo.</p>
<p>The remaining part is harder than what was done so far. How to make the server aware of the changes and how to communicate the changes to the browser?</p>
<p><a href="https://www.npmjs.com/package/browser-refresh">browser-refresh</a> can come in handy as it solves both of the problems. Install it first:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> browser-refresh --save-dev
</code></pre>
<p>The client portion requires two small changes to the server code:</p>
<p><strong>server.js</strong></p>
<pre><code class="lang-javascript"><span class="token function" >server</span><span class="token punctuation" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>PORT <span class="token operator" >||</span> <span class="token number" >8080</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >function</span> <span class="token function" >server</span><span class="token punctuation" >(</span>port<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<div class="leanpub-delete">
  app<span class="token punctuation" >.</span><span class="token function" >listen</span><span class="token punctuation" >(</span>port<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>
<div class="leanpub-insert">
  app<span class="token punctuation" >.</span><span class="token function" >listen</span><span class="token punctuation" >(</span>port<span class="token punctuation" >,</span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> process<span class="token punctuation" >.</span>send <span class="token operator" >&amp;&amp;</span> process<span class="token punctuation" >.</span><span class="token function" >send</span><span class="token punctuation" >(</span><span class="token string" >'online'</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>
<span class="token punctuation" >}</span>

<span class="token keyword" >function</span> <span class="token function" >renderMarkup</span><span class="token punctuation" >(</span>html<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> `<span class="token operator" >&lt;</span><span class="token operator" >!</span>DOCTYPE html<span class="token operator" >></span>
<span class="token operator" >&lt;</span>html<span class="token operator" >></span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
  <span class="token operator" >&lt;</span>body<span class="token operator" >></span>
    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-insert">
    <span class="token operator" >&lt;</span>script src<span class="token operator" >=</span><span class="token string" >"${process.env.BROWSER_REFRESH_URL}"</span><span class="token operator" >></span><span class="token operator" >&lt;</span><span class="token operator" >/</span>script<span class="token operator" >></span>
</div>
  <span class="token operator" >&lt;</span><span class="token operator" >/</span>body<span class="token operator" >></span>
<span class="token operator" >&lt;</span><span class="token operator" >/</span>html<span class="token operator" >></span>`<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>The first change tells the client that the application is online and ready to go. The latter change attaches the client script to the output. <em>browser-refresh</em> manages the environment variable in question.</p>
<p>Run <code>node_modules/.bin/browser-refresh ./server.js</code> in another terminal and open the browser at <code>http://localhost:8080</code> as earlier to test the setup. Remember to have webpack running in the watch mode at another terminal. If everything went right, any change you make to the demo client script (<em>app/ssr.js</em>) should show up in the browser or cause a failure at the server.</p>
<p>If the server crashes, it loses the WebSocket connection. You have to force a refresh in the browser in this case. If the server was managed through webpack as well, the problem could have been avoided.</p>
<p>To prove that SSR works, check out the browser inspector. You should see something familiar there:</p>
<p><img src="/b1293b4a79c3e8f4b07a6feeb87bd855.png" alt="SSR output" class="" width="" height="" /></p>
<p>Instead of a <code>div</code> where to mount an application, you can see all related HTML there. It&#39;s not much in this particular case, but it&#39;s enough to showcase the approach.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>The implementation could be refined further by implementing a production mode for the server that would skip injecting the browser refresh script at a minimum. The server could inject initial data payload to the generated HTML. Doing this would avoid queries on the client-side.</blockquote><h2 class="header"><a class="header-anchor" href="#open-questions" id="open-questions"></a><span class="text">Open Questions</span><a class="header-anchor-select" href="#open-questions">#</a></h2>
<p>Even though the demo illustrates the basic idea of SSR, it still leaves open questions:</p>
<ul>
<li>How to deal with styles? Node doesn&#39;t understand CSS related imports.</li>
<li>How to deal with anything else than JavaScript? If the server side is processed through webpack, this is less of an issue as you can patch it at webpack.</li>
<li>How to run the server through something else than Node? One option would be to wrap the Node instance in a service you then run through your host environment. Ideally, the results would be cached, and you can find more specific solutions for this particular per platform.</li>
</ul>
<p>Questions like these are the reason why solutions such as <a href="https://www.npmjs.com/package/isomorphic-webpack">isomorphic-webpack</a> or <a href="https://github.com/zeit/next.js">Next.js</a> exist. They have been designed to solve SSR-specific problems like these.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Routing is a big problem of its own solved by frameworks like Next.js. Patrick Hund <a href="https://ebaytech.berlin/universal-web-apps-with-react-router-4-15002bb30ccb">discusses how to solve it with React and React Router 4</a>.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>SSR comes with a technical challenge and for this reason specific solutions have appeared around it. Webpack is a good fit for SSR setups.</p>
<p>To recap:</p>
<ul>
<li><strong>Server Side Rendering</strong> can provide more for the browser to render initially. Instead of waiting for the JavaScript to load, you can display markup instantly.</li>
<li>Server Side Rendering also allows you to pass initial payload of data to the client to avoid unnecessary queries to the server.</li>
<li>Webpack can manage the client side portion of the problem. It can be used to generate the server as well if more integrated solution is required. Abstractions, such as Next.js, hide these details.</li>
<li>Server Side Rendering does not come without a cost and it leads to new problems as you need better approaches for dealing with aspects, such as styling or routing. The server and the client environment differ in important manners, so code has to be written so that it does not rely on platform-specific features too much.</li>
</ul>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this page, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/bfb2a0af5e20f281c7f1ab232cefa5d0.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/output/multiple-pages/">Multiple Pages</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/f3fe2111e8b2c482396522c226ff5f19.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/techniques/">Techniques</a></div></div><blockquote class="tip"><p>This book is available through <a href="https://leanpub.com/survivejs-webpack">Leanpub (digital)</a>, <a href="https://www.amazon.com/dp/9526868803">Amazon (paperback)</a>, and <a href="https://www.amazon.com/dp/B06XWZZGBS">Kindle (digital)</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Techniques" href="/webpack/techniques/"><i class="icon-right-open"></i></a><a class="previous-page" title="Multiple Pages" href="/webpack/output/multiple-pages/"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a href="/">Home</a></div><div class="nav__link"><a href="/blog/">Read the blog</a></div><div class="nav__link"><a href="/training/">Get training</a></div><div class="nav__link"><a href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a href="/"></a></div><div class="nav__link"><a href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank" rel="noopener noreferrer">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank" rel="noopener noreferrer">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank" rel="noopener noreferrer">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="https://presentations.survivejs.com" target="_blank" rel="noopener noreferrer">Presentations</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank" rel="noopener noreferrer">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank" rel="noopener noreferrer">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/unexpected-react-interview/">unexpected-react - Test Full Virtual DOM - Interview with Dave Brotherstone</a></li><li><a class="blog-teaser" href="/blog/webexpo-2017/">Experiences on WebExpo 2017</a></li><li><a class="blog-teaser" href="/blog/kea-interview/">Kea - High level abstraction between React and Redux - Interview with Marius Andra</a></li><li><a class="blog-teaser" href="/blog/react-next-2017/">Experiences on React Next 2017</a></li><li><a class="blog-teaser" href="/blog/frint-interview/">FrintJS - Build reactive applications with React and RxJS - Interview with Fahad Ibnay Heylaal</a></li><li><a class="blog-teaser" href="/blog/neutrino-interview/">Neutrino - Create modern JavaScript applications with minimal configuration - Interview with Eli Perelman</a></li><li><a class="blog-teaser" href="/blog/idyll-interview/">Idyll - Narratives for the web - Interview with Matthew Conlen</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
          ((window.gitter = {}).chat = {}).options = {
            showChatByDefault: false,
            activationElement: '.gitter-open-chat-button',
            room: 'survivejs/react'
          };
        </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
        docsearch({
          apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
          indexName: 'survivejs_webpack',
          inputSelector: '#search',
          debug: false
        });
      </script></div></div>

    
  </body>
</html>
