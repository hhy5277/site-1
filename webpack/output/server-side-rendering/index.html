<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
    <meta
      name="description"
      content="
Server Side Rendering (SSR) is a technique that allows you to serve an initial payload with HTML, J…" />
    <meta
      name="keywords"
      content="" />
    <meta property="og:site_name" content="SurviveJS" />
    <meta property="og:title" content="Server Side Rendering" />
    <meta property="og:description" content="
Server Side Rendering (SSR) is a technique that allows you to serve an initial payload with HTML, J…" />
    <meta name="twitter:title" content="Server Side Rendering" />
    <meta name="twitter:description" content="
Server Side Rendering (SSR) is a technique that allows you to serve an initial payload with HTML, J…" />
    <meta name="twitter:site" content="@SurviveJS" />
    <title>Server Side Rendering</title>
    
    <link rel='icon' type='image/png' href='/favicon.png'></link>

    
      <link href="/site.3c4a798365292465d0a2.css" rel="stylesheet">
    

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"
    />
  </head>
  <body>
    <header class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><a title="Multiple Pages" aria-hidden="true" class="css-17k05uf css-isbjic0" href="/webpack/output/multiple-pages/"><i class="icon-left-open"></i></a><nav class="nav"><ul class="nav__items"><li class="nav__link"><a href="https://graphql-finland.fi/">GraphQL Finland</a></li><li class="nav__link"><a href="/">Home</a></li><li class="nav__link"><a href="/blog/">Read the blog</a></li><li class="nav__link"><a href="/maintenance/">Maintenance book</a></li><li class="nav__link"><a href="/react/">React book</a></li><li class="nav__link nav__link_selected"><a href="/webpack/">Webpack book</a></li><li class="nav__link"><a href="/training/">Hire me</a></li><li class="nav__link"><a href="https://twitter.com/survivejs">@survivejs</a></li></ul></nav><a title="Techniques" aria-hidden="true" class="css-17k05uf css-isbjic0" href="/webpack/techniques/"><i class="icon-right-open"></i></a></header><div class="page"><div class="css-b5dhuc css-8rlsag0"><div style="background-image:url(/363f7aaeb17b7fdd689d1cbb34f2252b.jpg)" class="css-1huzfyy css-8rlsag1"></div><h1 class="css-13wbkqf css-8rlsag2">Server Side Rendering</h1><small aria-hidden="true" class="css-18xzi2i css-8rlsag3"><a href="https://pixabay.com/en/technology-servers-server-1587673/">heladodementa (Public Domain)</a></small></div><div class="page__container"><div class="css-xfgthk css-20xtq50"><label for="sidebar-toggle" class="css-1whlnn6 css-20xtq52">Table of contents</label><input type="checkbox" id="sidebar-toggle" class="css-38lglc css-20xtq53"/><div class="css-nyzxad css-20xtq51"><div class="toc-nav__wrapper"><div class="toc-nav__section"><input id="search" class="toc-nav__search" placeholder="Search"/></div><div class="toc-nav__section"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword/">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface/">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction/">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack/">What is Webpack</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing/">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started/">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/webpack-dev-server/">webpack-dev-server</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration/">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling/">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading/">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css/">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css/">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing/">Autoprefixing</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading/">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions/">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images/">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts/">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript/">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building/">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps/">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/bundle-splitting/">Bundle Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting/">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up/">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing/">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying/">Minifying</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking/">Tree Shaking</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/environment-variables/">Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames/">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest/">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/build-analysis/">Build Analysis</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance/">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output/">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets/">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages/">Multiple Pages</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Server Side Rendering</span></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques/">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading/">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers/">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n/">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing/">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying/">Deploying Applications</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/consuming/">Consuming Packages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending/">Extending</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/loaders/">Extending with Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins/">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion/">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices/">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison/">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr/">Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/css-modules/">CSS Modules</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react/">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting/">Troubleshooting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/glossary/">Glossary</a></li></ul></div><div class="toc-nav__section"></div></div></div></div><div class="page__main"><div class="page__section"><div><blockquote class="latestpost tip"><a class="latestpost-link" href="/blog/webexpo-2018/">Experiences on WebExpo 2018</a></blockquote></div><div class="chapter-content"><p><strong>Server Side Rendering</strong> (SSR) is a technique that allows you to serve an initial payload with HTML, JavaScript, CSS, and even application state. You serve a fully rendered HTML page that would make sense even without JavaScript enabled. In addition to providing potential performance benefits, this can help with Search Engine Optimization (SEO).</p>
<p>Even though the idea does not sound that unique, there is a technical cost. The approach was popularized by React. Since then frameworks encapsulating the tricky bits, such as <a href="https://www.npmjs.com/package/next">Next.js</a> and <a href="https://www.npmjs.com/package/razzle">razzle</a>, have appeared.</p>
<p>To demonstrate SSR, you can use webpack to compile a client-side build that then gets picked up by a server that renders it using React following the principle. Doing this is enough to understand how it works and also where the problems begin.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>SSR isn&#39;t the only solution to the SEO problem. <strong>Prerendering</strong> is an alternate technique that is easier to implement if it fits your use case. The approach won&#39;t work well with highly dynamic data. <a href="https://www.npmjs.com/package/prerender-spa-plugin">prerender-spa-plugin</a> allows you to implement it with webpack.</blockquote><h2 class="header"><a class="header-anchor" href="#setting-up-babel-with-react" id="setting-up-babel-with-react"></a><span class="text">Setting Up Babel with React</span><a class="header-anchor-select" href="#setting-up-babel-with-react">#</a></h2>
<p>The <a href="/webpack/loading/javascript/">Loading JavaScript</a> chapter covers the essentials of using Babel with webpack. There&#39;s setup that is particular to React you should perform, though. Given most of React projects rely on <a href="https://facebook.github.io/jsx/">JSX</a> format, you have to enable it through Babel.</p>
<p>To get React, and particularly JSX, work with Babel, install the preset first:</p>
<pre><code class="lang-bash"><span class="token function" >npm</span> <span class="token function" >install</span> @babel/preset-react --save-dev
</code></pre>
<p>Connect the preset with Babel configuration as follows:</p>
<p><strong>.babelrc</strong></p>
<pre><code class="lang-json"><span class="token punctuation brackets-braces" >{</span>
  ...
  <span class="token property" >"presets"</span><span class="token operator" >:</span> <span class="token punctuation brackets-square" >[</span>
<div class="leanpub-insert">
    <span class="token string" >"@babel/preset-react"</span><span class="token punctuation" >,</span>
</div>
    ...
  <span class="token punctuation brackets-square" >]</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-react-demo" id="setting-up-a-react-demo"></a><span class="text">Setting Up a React Demo</span><a class="header-anchor-select" href="#setting-up-a-react-demo">#</a></h2>
<p>To make sure the project has the dependencies in place, install React and <a href="https://www.npmjs.com/package/react-dom">react-dom</a>. The latter package is needed to render the application to the DOM.</p>
<pre><code class="lang-bash"><span class="token function" >npm</span> <span class="token function" >install</span> react react-dom --save
</code></pre>
<p>Next, the React code needs a small entry point. If you are on the browser side, you should mount <code>Hello world</code> <code>div</code> to the document. To prove it works, clicking it should give a dialog with a &quot;hello&quot; message. On server-side, the React component is returned and the server can pick it up.</p>
<p>Adjust as follows:</p>
<p><strong>src/ssr.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> React <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"react"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> ReactDOM <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"react-dom"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> SSR <span class="token operator" >=</span> <span class="token operator" >&lt;</span>div onClick<span class="token operator" >=</span><span class="token punctuation brackets-braces" >{</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> <span class="token function" >alert</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"hello"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-braces" >}</span><span class="token operator" >&gt;</span>Hello world<span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span><span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true" >// Render only in the browser, export otherwise</span>
<span class="token keyword keyword-if" >if</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token keyword keyword-typeof" >typeof</span> document <span class="token operator" >===</span> <span class="token string" >"undefined"</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> SSR<span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span> <span class="token keyword keyword-else" >else</span> <span class="token punctuation brackets-braces" >{</span>
  ReactDOM<span class="token punctuation" >.</span><span class="token function" >hydrate</span><span class="token punctuation brackets-parentheses" >(</span>SSR<span class="token punctuation" >,</span> document<span class="token punctuation" >.</span><span class="token function" >getElementById</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"app"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>You are still missing webpack configuration to turn this file into something the server can pick up.</p>
<blockquote class="warning"><i class="icon-attention"></i>Given ES2015 style imports and CommonJS exports cannot be mixed, the entry point was written in CommonJS style.</blockquote><h2 class="header"><a class="header-anchor" href="#configuring-webpack" id="configuring-webpack"></a><span class="text">Configuring Webpack</span><a class="header-anchor-select" href="#configuring-webpack">#</a></h2>
<p>To keep things nice, we will define a separate configuration file. A lot of the work has been done already. Given you have to consume the same output from multiple environments, using UMD as the library target makes sense:</p>
<p><strong>webpack.ssr.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"path"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> merge <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"webpack-merge"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> parts <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"./webpack.parts"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> PATHS <span class="token operator" >=</span> <span class="token punctuation brackets-braces" >{</span>
  build<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"static"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
  ssrDemo<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation brackets-parentheses" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"src"</span><span class="token punctuation" >,</span> <span class="token string" >"ssr.js"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-square" >[</span>
  <span class="token punctuation brackets-braces" >{</span>
    mode<span class="token punctuation" >:</span> <span class="token string" >"production"</span><span class="token punctuation" >,</span>
    entry<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
      index<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>ssrDemo<span class="token punctuation" >,</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation brackets-braces" >{</span>
      path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >"[name].js"</span><span class="token punctuation" >,</span>
      libraryTarget<span class="token punctuation" >:</span> <span class="token string" >"umd"</span><span class="token punctuation" >,</span>
      globalObject<span class="token punctuation" >:</span> <span class="token string" >"this"</span><span class="token punctuation" >,</span>
    <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >loadJavaScript</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-braces" >{</span> include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>ssrDemo <span class="token punctuation brackets-braces" >}</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation brackets-square" >]</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>To make it convenient to generate a build, add a helper script:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation brackets-braces" >{</span>
<div class="leanpub-insert">
  <span class="token property" >"build:ssr"</span><span class="token operator" >:</span> <span class="token string" >"webpack --config webpack.ssr.js"</span><span class="token punctuation" >,</span>
</div>
  ...
<span class="token punctuation brackets-braces" >}</span><span class="token punctuation" >,</span>
</code></pre>
<p>If you build the SSR demo (<code>npm run build:ssr</code>), you should see a new file at <em>./static/index.js</em>. The next step is to set up a server to render it.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-server" id="setting-up-a-server"></a><span class="text">Setting Up a Server</span><a class="header-anchor-select" href="#setting-up-a-server">#</a></h2>
<p>To keep things clear to understand, you can set up a standalone Express server that picks up the generated bundle and renders it following the SSR principle. Install Express first:</p>
<pre><code class="lang-bash"><span class="token function" >npm</span> <span class="token function" >install</span> express --save-dev
</code></pre>
<p>Then, to get something running, implement a server as follows:</p>
<p><strong>server.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword keyword-const" >const</span> express <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"express"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token keyword keyword-const" >const</span> <span class="token punctuation brackets-braces" >{</span> renderToString <span class="token punctuation brackets-braces" >}</span> <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"react-dom/server"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-const" >const</span> SSR <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"./static"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token function" >server</span><span class="token punctuation brackets-parentheses" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>PORT <span class="token operator" >||</span> <span class="token number" >8080</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-function" >function</span> <span class="token function" >server</span><span class="token punctuation brackets-parentheses" >(</span>port<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-const" >const</span> app <span class="token operator" >=</span> <span class="token function" >express</span><span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  app<span class="token punctuation" >.</span><span class="token function" >use</span><span class="token punctuation brackets-parentheses" >(</span>express<span class="token punctuation" >.</span><span class="token keyword keyword-static" >static</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"static"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
  app<span class="token punctuation" >.</span><span class="token keyword keyword-get" >get</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"/"</span><span class="token punctuation" >,</span> <span class="token punctuation brackets-parentheses" >(</span>req<span class="token punctuation" >,</span> res<span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span>
    res<span class="token punctuation" >.</span><span class="token function" >status</span><span class="token punctuation brackets-parentheses" >(</span><span class="token number" >200</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >.</span><span class="token function" >send</span><span class="token punctuation brackets-parentheses" >(</span><span class="token function" >renderMarkup</span><span class="token punctuation brackets-parentheses" >(</span><span class="token function" >renderToString</span><span class="token punctuation brackets-parentheses" >(</span>SSR<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span>
  <span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

  app<span class="token punctuation" >.</span><span class="token function" >listen</span><span class="token punctuation brackets-parentheses" >(</span>port<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>

<span class="token keyword keyword-function" >function</span> <span class="token function" >renderMarkup</span><span class="token punctuation brackets-parentheses" >(</span>html<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-return" >return</span> `<span class="token operator" >&lt;</span><span class="token operator" >!</span>DOCTYPE html<span class="token operator" >&gt;</span>
<span class="token operator" >&lt;</span>html<span class="token operator" >&gt;</span>
  <span class="token operator" >&lt;</span>head<span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span>title<span class="token operator" >&gt;</span>Webpack SSR Demo<span class="token operator" >&lt;</span><span class="token operator" >/</span>title<span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span>meta charset<span class="token operator" >=</span><span class="token string" >"utf-8"</span> <span class="token operator" >/</span><span class="token operator" >&gt;</span>
  <span class="token operator" >&lt;</span><span class="token operator" >/</span>head<span class="token operator" >&gt;</span>
  <span class="token operator" >&lt;</span>body<span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span>div id<span class="token operator" >=</span><span class="token string" >"app"</span><span class="token operator" >&gt;</span>$<span class="token punctuation brackets-braces" >{</span>html<span class="token punctuation brackets-braces" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >&gt;</span>
    <span class="token operator" >&lt;</span>script src<span class="token operator" >=</span><span class="token string" >"./index.js"</span><span class="token operator" >&gt;</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>script<span class="token operator" >&gt;</span>
  <span class="token operator" >&lt;</span><span class="token operator" >/</span>body<span class="token operator" >&gt;</span>
<span class="token operator" >&lt;</span><span class="token operator" >/</span>html<span class="token operator" >&gt;</span>`<span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>Run the server now (<code>node ./server.js</code>) and go below <code>http://localhost:8080</code>, you should see something familiar:</p>
<p><figure><img src="/269f6006ae745ead9a1ba1c57ec37223.png" alt="Hello world" class="" width="" height="" /><figcaption>Hello world</figcaption></figure></p>
<p>Even though there is a React application running now, it&#39;s difficult to develop. If you try to modify the code, nothing happens. The problem can be solved running webpack in a multi-compiler mode as earlier in this book. Another option is to run webpack in <strong>watch mode</strong> against the current configuration and set up a watcher for the server. You&#39;ll learn the setup next.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to debug output from the server, set <code>export DEBUG=express:application</code>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>The references to the assets generated by webpack could be written automatically to the server side template if you wrote a manifest as discussed in the <a href="/webpack/optimizing/separating-manifest/">Separating a Manifest</a> chapter.</blockquote><h2 class="header"><a class="header-anchor" href="#watching-ssr-changes-and-refreshing-the-browser" id="watching-ssr-changes-and-refreshing-the-browser"></a><span class="text">Watching SSR Changes and Refreshing the Browser</span><a class="header-anchor-select" href="#watching-ssr-changes-and-refreshing-the-browser">#</a></h2>
<p>The first portion of the problem is fast to solve. Run <code>npm run build:ssr -- --watch</code> in a terminal. That forces webpack to run in a watch mode. It would be possible to wrap this idea within an npm script for convenience, but this is enough for this demo.</p>
<p>The remaining part is harder than what was done so far. How to make the server aware of the changes and how to communicate the changes to the browser?</p>
<p><a href="https://www.npmjs.com/package/browser-refresh">browser-refresh</a> can come in handy as it solves both of the problems. Install it first:</p>
<pre><code class="lang-bash"><span class="token function" >npm</span> <span class="token function" >install</span> browser-refresh --save-dev
</code></pre>
<p>The client portion requires two small changes to the server code:</p>
<p><strong>server.js</strong></p>
<pre><code class="lang-javascript"><span class="token function" >server</span><span class="token punctuation brackets-parentheses" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>PORT <span class="token operator" >||</span> <span class="token number" >8080</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>

<span class="token keyword keyword-function" >function</span> <span class="token function" >server</span><span class="token punctuation brackets-parentheses" >(</span>port<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token operator" >...</span>

<div class="leanpub-delete">
  app<span class="token punctuation" >.</span><span class="token function" >listen</span><span class="token punctuation brackets-parentheses" >(</span>port<span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
<div class="leanpub-insert">
  app<span class="token punctuation" >.</span><span class="token function" >listen</span><span class="token punctuation brackets-parentheses" >(</span>port<span class="token punctuation" >,</span> <span class="token punctuation brackets-parentheses" >(</span><span class="token punctuation brackets-parentheses" >)</span> <span class="token operator" >=&gt;</span> process<span class="token punctuation" >.</span>send <span class="token operator" >&amp;&amp;</span> process<span class="token punctuation" >.</span><span class="token function" >send</span><span class="token punctuation brackets-parentheses" >(</span><span class="token string" >"online"</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation brackets-parentheses" >)</span><span class="token punctuation" >;</span>
</div>
<span class="token punctuation brackets-braces" >}</span>

<span class="token keyword keyword-function" >function</span> <span class="token function" >renderMarkup</span><span class="token punctuation brackets-parentheses" >(</span>html<span class="token punctuation brackets-parentheses" >)</span> <span class="token punctuation brackets-braces" >{</span>
  <span class="token keyword keyword-return" >return</span> `<span class="token operator" >&lt;</span><span class="token operator" >!</span>DOCTYPE html<span class="token operator" >&gt;</span>
<span class="token operator" >&lt;</span>html<span class="token operator" >&gt;</span>
  <span class="token operator" >...</span>
  <span class="token operator" >&lt;</span>body<span class="token operator" >&gt;</span>
    <span class="token operator" >...</span>
<div class="leanpub-insert">
    <span class="token operator" >&lt;</span>script src<span class="token operator" >=</span><span class="token string" >"${process.env.BROWSER_REFRESH_URL}"</span><span class="token operator" >&gt;</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>script<span class="token operator" >&gt;</span>
</div>
  <span class="token operator" >&lt;</span><span class="token operator" >/</span>body<span class="token operator" >&gt;</span>
<span class="token operator" >&lt;</span><span class="token operator" >/</span>html<span class="token operator" >&gt;</span>`<span class="token punctuation" >;</span>
<span class="token punctuation brackets-braces" >}</span>
</code></pre>
<p>The first change tells the client that the application is online and ready to go. The latter change attaches the client script to the output. <em>browser-refresh</em> manages the environment variable in question.</p>
<p>Run <code>node_modules/.bin/browser-refresh ./server.js</code> in another terminal and open the browser at <code>http://localhost:8080</code> as earlier to test the setup. Remember to have webpack running in the watch mode at another terminal (<code>npm run build:ssr -- --watch</code>). If everything went right, any change you make to the demo client script (<em>app/ssr.js</em>) should show up in the browser or cause a failure at the server.</p>
<p>If the server crashes, it loses the WebSocket connection. You have to force a refresh in the browser in this case. If the server was managed through webpack as well, the problem could have been avoided.</p>
<p>To prove that SSR works, check out the browser inspector. You should see something familiar there:</p>
<p><figure><img src="/b1293b4a79c3e8f4b07a6feeb87bd855.png" alt="SSR output" class="" width="" height="" /><figcaption>SSR output</figcaption></figure></p>
<p>Instead of a <code>div</code> where to mount an application, you can see all related HTML there. It&#39;s not much in this particular case, but it&#39;s enough to showcase the approach.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>The implementation could be refined further by implementing a production mode for the server that would skip injecting the browser refresh script at a minimum. The server could inject initial data payload into the generated HTML. Doing this would avoid queries on the client-side.</blockquote><h2 class="header"><a class="header-anchor" href="#open-questions" id="open-questions"></a><span class="text">Open Questions</span><a class="header-anchor-select" href="#open-questions">#</a></h2>
<p>Even though the demo illustrates the basic idea of SSR, it still leaves open questions:</p>
<ul>
<li>How to deal with styles? Node doesn&#39;t understand CSS related imports.</li>
<li>How to deal with anything other than JavaScript? If the server side is processed through webpack, this is less of an issue as you can patch it at webpack.</li>
<li>How to run the server through something else other than Node? One option would be to wrap the Node instance in a service you then run through your host environment. Ideally, the results would be cached, and you can find more specific solutions for this particular per platform.</li>
</ul>
<p>Questions like these are the reason why solutions such as Next.js or razzle exist. They have been designed to solve SSR-specific problems like these.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Routing is a big problem of its own solved by frameworks like Next.js. Patrick Hund <a href="https://ebaytech.berlin/universal-web-apps-with-react-router-4-15002bb30ccb">discusses how to solve it with React and React Router 4</a>.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>SSR comes with a technical challenge, and for this reason, specific solutions have appeared around it. Webpack is a good fit for SSR setups.</p>
<p>To recap:</p>
<ul>
<li><strong>Server Side Rendering</strong> can provide more for the browser to render initially. Instead of waiting for the JavaScript to load, you can display markup instantly.</li>
<li>Server Side Rendering also allows you to pass initial payload of data to the client to avoid unnecessary queries to the server.</li>
<li>Webpack can manage the client-side portion of the problem. It can be used to generate the server as well if a more integrated solution is required. Abstractions, such as Next.js, hide these details.</li>
<li>Server Side Rendering does not come without a cost, and it leads to new problems as you need better approaches for dealing with aspects, such as styling or routing. The server and the client environment differ in essential manners, so the code has to be written so that it does not rely on platform-specific features too much.</li>
</ul>
</div></div><div class="page__section"><div class="social-links"><h2 class="social-links__header">Subscribe to the blog updates</h2><blockquote class="tip social-links__tip">If you enjoyed this page, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" target="_blank" class="css-1nfeoes css-va8n550"><input type="email" class="css-baseStyle-s4lgck css-inputStyle-16d70pc" placeholder="Email" name="EMAIL" id="mce-EMAIL" required=""/><div style="display:none;position:absolute;left:-5000px"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><input type="submit" class="css-baseStyle-s4lgck css-buttonStyle-1y781j1" value="Subscribe" name="subscribe"/></form></div><div class="css-r9vozr css-7ic71f0"><div class="css-panel-1asgzqv css-panelPrev-h368eu"><div class="css-1njlj0m css-7ic71f1">Previous chapter</div><a class="css-link-h8hsyv css-linkPrev-966ksh" href="/webpack/output/multiple-pages/">Multiple Pages</a></div><div class="css-panel-1asgzqv css-panelNext-1i6c957"><div class="css-1njlj0m css-7ic71f1">Next chapter</div><a class="css-link-h8hsyv css-linkNext-1a0mc68" href="/webpack/techniques/">Techniques</a></div></div><blockquote class="tip"><p>This book is available through <a href="https://leanpub.com/survivejs-webpack">Leanpub (digital)</a>, <a href="https://www.amazon.com/dp/9526868803">Amazon (paperback)</a>, and <a href="https://www.amazon.com/dp/B06XWZZGBS">Kindle (digital)</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of webpack.</p></blockquote><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div></div></div></div><footer class="css-eo7znu css-iscbe10"><ul class="css-jtawwa css-iscbe13 css-6482o6 css-3yjlwf0"><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://twitter.com/survivejs" target="_blank" rel="noopener noreferrer">@survivejs</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://eepurl.com/bth1v5" target="_blank" rel="noopener noreferrer">Mailing List</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://gitter.im/survivejs" target="_blank" rel="noopener noreferrer">Gitter Chat</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs" target="_blank" rel="noopener noreferrer">GitHub</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://presentations.survivejs.com" target="_blank" rel="noopener noreferrer">Presentations</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank" rel="noopener noreferrer">Contact</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="https://github.com/survivejs/ama/issues" target="_blank" rel="noopener noreferrer">Ask Me Anything</a></li><li class="css-haw22i css-iscbe14 css-10ozgd1 css-17pd6qu0"><a href="/atom.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><div class="css-1gd1yml css-iscbe11"><h3 class="css-oi3rzz css-iscbe12">From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/webexpo-2018/">Experiences on WebExpo 2018</a></li><li><a class="blog-teaser" href="/blog/refract-interview/">Refract - Manage Component Side Effects the Reactive Way - Interview with Thomas Roch.</a></li><li><a class="blog-teaser" href="/blog/dss-interview/">DSS - Deterministic Style Sheets - Interview with Giuseppe Gurgone</a></li><li><a class="blog-teaser" href="/blog/fall-2018-events/">SurviveJS - Fall Events</a></li><li><a class="blog-teaser" href="/blog/uppy-interview/">Uppy - Painless Uploads for JavaScript - Interview with Artur Paikin</a></li><li><a class="blog-teaser" href="/blog/graphql-finland-interview/">GraphQL Finland - Learn GraphQL Up North - Interview with Mikhail Novikov</a></li><li><a class="blog-teaser" href="/blog/pwa-interview/">Progressive Web Apps - The Why and How - Interview with Maciej Caputa</a></li></ul></div><ul aria-label="Other Juho&#x27;s books" class="css-6482o6 css-3yjlwf0"><li class="css-jtawwa css-nbe2jc1 css-10ozgd1 css-17pd6qu0"><a href="/maintenance/introduction"><h4 class="css-i1gwhw css-nbe2jc0">SurviveJS - Maintenance: Streamline JavaScript Workflow</h4><img alt="Maintenance book cover" src="/2900d9b74e46ac6cdf984148c1a0c631.svg" width="255" height="329" class="css-1d87hyi css-nbe2jc2"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-maintenance">Buy at Leanpub</a></li><li class="css-jtawwa css-nbe2jc1 css-10ozgd1 css-17pd6qu0"><a href="/react/introduction"><h4 class="css-i1gwhw css-nbe2jc0">SurviveJS - React: From apprentice to master</h4><img alt="React book cover" src="/2412b7150d25c1dc3c309666132bc26e.svg" width="255" height="329" class="css-1d87hyi css-nbe2jc2"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></li><li class="css-jtawwa css-nbe2jc1 css-10ozgd1 css-17pd6qu0"><a href="/webpack/foreword"><h4 class="css-i1gwhw css-nbe2jc0">SurviveJS - Webpack: From apprentice to master</h4><img alt="Webpack book cover" src="/20cf3367cf445212a90411ccd2282229.svg" width="255" height="329" class="css-1d87hyi css-nbe2jc2"/></a><a class="btn btn--normal css-button-v0k0bo" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/9526868803/">Buy at Amazon</a><a class="btn btn--normal css-button-v0k0bo" href="https://www.amazon.com/dp/B06XWZZGBS">Buy for Kindle</a></li></ul></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
          ((window.gitter = {}).chat = {}).options = {
            showChatByDefault: false,
            activationElement: '.gitter-open-chat-button',
            room: 'survivejs/react'
          };
        </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
        docsearch({
          apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
          indexName: 'survivejs_webpack',
          inputSelector: '#search',
          debug: false
        });
      </script></div>

    
  </body>
</html>
